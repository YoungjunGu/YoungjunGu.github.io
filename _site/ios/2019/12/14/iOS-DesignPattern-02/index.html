<!DOCTYPE html>
<html lang="en"><!--
 __  __                __                                     __
/\ \/\ \              /\ \             __                    /\ \
\ \ \_\ \   __  __    \_\ \      __   /\_\      __       ___ \ \ \/'\
 \ \  _  \ /\ \/\ \   /'_` \   /'__`\ \/\ \   /'__`\    /'___\\ \ , <
  \ \ \ \ \\ \ \_\ \ /\ \L\ \ /\  __/  \ \ \ /\ \L\.\_ /\ \__/ \ \ \\`\
   \ \_\ \_\\/`____ \\ \___,_\\ \____\ _\ \ \\ \__/.\_\\ \____\ \ \_\ \_\
    \/_/\/_/ `/___/> \\/__,_ / \/____//\ \_\ \\/__/\/_/ \/____/  \/_/\/_/
                /\___/                \ \____/
                \/__/                  \/___/

Powered by Hydejack v6.4.0 (https://qwtel.com/hydejack/)
-->









<head>
  <!-- =============== -->
<!-- META            -->
<!-- =============== -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="format-detection" content="telephone=no" />
<meta http-equiv="x-ua-compatible" content="ie=edge" />
<meta
  name="naver-site-verification"
  content="22c5b4ef3bfda7fc6100671413989219de7a4ac8"
/>
<meta property="og:title" content="DAO Pattern" />
<meta property="og:type" content="article" />

<!-- =============== -->
<!-- Google AdSense  -->
<!-- =============== -->
<script
  data-ad-client="ca-pub-8247516864622650"
  async
  src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"
></script>

 
<meta property="og:image" content="http://localhost:4000/assets/img/logo.png" />


<meta property="og:image:width" content="640" />
<meta property="og:image:height" content="360" />
 
<title>DAO Pattern &middot; Gaki</title>
 
<meta
  name="description"
  content="DAO 패턴이란?

"
/>
<meta
  property="og:description"
  content="DAO 패턴이란?

"
/>



<!-- =============== -->
<!-- LINKS           -->
<!-- =============== -->
<link rel="canonical" href="http://localhost:4000/ios/2019/12/14/iOS-DesignPattern-02/" />
<meta property="og:url" content="http://localhost:4000/ios/2019/12/14/iOS-DesignPattern-02/" />

<link
  rel="alternate"
  type="application/atom+xml"
  title="Gaki Feed"
  href="http://localhost:4000/feed.xml"
/>


<link rel="prev" href="http://localhost:4000/life/2019/11/25/Life-Review-01/" />
 
<link rel="next" href="http://localhost:4000/swift/2019/12/23/Swift-RxSwift-03/" />


<link
  rel="apple-touch-icon"
  href="http://localhost:4000/apple-touch-icon.png"
/>
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?" />
<!-- Place favicon.ico in the root directory -->

<!-- =============== -->
<!-- SCRIPTS         -->
<!-- =============== -->
<script>
  !function(n,e){function t(n,e){n.onload=function(){this.onerror=this.onload=null,e(null,n)},n.onerror=function(){this.onerror=this.onload=null,e(new Error("Failed to load "+this.src),n)}}function o(n,e){n.onreadystatechange=function(){"complete"!=this.readyState&&"loaded"!=this.readyState||(this.onreadystatechange=null,e(null,n))}}n._loaded=!1,n.loadJSDeferred=function(a,d){function r(){n._loaded=!0;var r=e.createElement("script");r.src=a,d&&(("onload"in r?t:o)(r,d),r.onload||t(r,d));var l=e.getElementsByTagName("script")[0];l.parentNode.insertBefore(r,l)}n._loaded?r():n.addEventListener?n.addEventListener("load",r,!1):n.attachEvent?n.attachEvent("onload",r):n.onload=r}}(window,document);

  !function(e){"use strict";var n=function(n,t,o){function i(e){if(a.body)return e();setTimeout(function(){i(e)})}function r(){l.addEventListener&&l.removeEventListener("load",r),l.media=o||"all"}var d,a=e.document,l=a.createElement("link");if(t)d=t;else{var f=(a.body||a.getElementsByTagName("head")[0]).childNodes;d=f[f.length-1]}var s=a.styleSheets;l.rel="stylesheet",l.href=n,l.media="only x",i(function(){d.parentNode.insertBefore(l,t?d:d.nextSibling)});var u=function(e){for(var n=l.href,t=s.length;t--;)if(s[t].href===n)return e();setTimeout(function(){u(e)})};return l.addEventListener&&l.addEventListener("load",r),l.onloadcssdefined=u,u(r),l};"undefined"!=typeof exports?exports.loadCSS=n:e.loadCSS=n}("undefined"!=typeof global?global:this);

  !function(t){if(t.loadCSS){var e=loadCSS.relpreload={};if(e.support=function(){try{return t.document.createElement("link").relList.supports("preload")}catch(t){return!1}},e.poly=function(){for(var e=t.document.getElementsByTagName("link"),r=0;r<e.length;r++){var n=e[r];"preload"===n.rel&&"style"===n.getAttribute("as")&&(t.loadCSS(n.href,n,n.getAttribute("media")),n.rel=null)}},!e.support()){e.poly();var r=t.setInterval(e.poly,300);t.addEventListener&&t.addEventListener("load",function(){e.poly(),t.clearInterval(r)}),t.attachEvent&&t.attachEvent("onload",function(){t.clearInterval(r)})}}}(this);

  window.disablePushState = false;
  window.disableDrawer = false;
</script>

<!--[if lt IE 9]>
  <script src="https://unpkg.com/html5shiv/dist/html5shiv.min.js"></script>
<![endif]-->

<!-- =============== -->
<!-- STYLES          -->
<!-- =============== -->
<!--[if gt IE 8]><!---->
<style>
  
  article,aside,dialog,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}mark{background:#FF0;color:#000}*{box-sizing:border-box}html,body{margin:0;padding:0}html{font-size:16px;line-height:1.75}body{color:#333;background-color:#fff;overflow-y:scroll}a{text-decoration:none}.lead{margin-left:-1rem;margin-right:-1rem}img,.img{display:block;max-width:100%;margin-bottom:1rem;border:none}img.lead,.img.lead{max-width:calc(100% + 2rem);width:calc(100% + 2rem)}h1,h2,h3,h4,h5,h6,.h1,.h2,.h3,.h4,.h5,.h6,.heading{font-weight:bold;text-rendering:optimizeLegibility}h1,h2,h3,h4,h5,h6,.h1,.h2,.h3,.h4,.h5,.h6{margin:1.6rem 0 1rem;line-height:1.6}h1,.h1{font-size:2rem;line-height:1.25}h2,.h2{font-size:1.5rem}h3,.h3{font-size:1.17em}p{margin-top:0;margin-bottom:1rem}p.lead{font-size:1.25rem;font-weight:300;padding:0 1rem}ul,ol,dl{margin-top:0;margin-bottom:1rem}ul,ol{padding-left:1.25rem}hr{position:relative;margin:1.5rem 0;border:0;border-top:1px solid #eee}.hr{padding-bottom:.5rem;border-bottom:1px solid #eee;margin-bottom:1.5rem}h4,h5,h6,.h4,.h5,.h6{margin-bottom:0.5rem;font-size:1rem}table{margin-bottom:1rem;width:100%;width:calc(100% + 2rem);margin-left:-1rem;border:1px solid #e5e5e5;border-collapse:collapse;border-spacing:0}td,th{padding:.25rem .5rem;border:1px solid #e5e5e5}td:first-child,th:first-child{padding-left:1rem}td:last-child,th:last-child{padding-right:1rem}thead+tbody,tbody+tbody,tfoot{border-top:3px double #e5e5e5}tbody tr:nth-child(odd) td,tbody tr:nth-child(odd) th{background-color:#f9f9f9}footer{margin-bottom:2rem}.page,.post{margin-bottom:3em}.page li+li,.post li+li{margin-top:.25rem}.page>header,.post>header{margin-bottom:2rem}.page-title,.post-title{margin-top:0}.post-date{display:block;margin-top:-0.5rem;margin-bottom:1rem;color:#9a9a9a}.related-posts{padding-left:0;list-style:none}.related-posts>li,.related-posts>li+li{margin-top:1rem}.related-posts>li>small,.related-posts>li+li>small{font-size:75%;color:#9a9a9a}.message{margin-bottom:1rem;padding:1rem;color:#787878;background-color:#f9f9f9;margin-left:-1rem;margin-right:-1rem}body,main{position:relative;overflow-x:hidden}@media screen{body::before{content:'';background:#e5e5e5;position:absolute;left:0;top:0;bottom:0}}@media screen and (min-width: 40em){html{font-size:17px}}@media screen and (min-width: 54em){html{font-size:16px}}@media screen and (min-width: 88em){html{font-size:17px}}@media screen and (min-width: 125em){html{font-size:18px}}.sr-only{display:none}.clearfix,.sidebar-social::after,.clearafter::after{content:"";display:table;clear:both}a,.a{position:relative;padding-bottom:.15rem;border-style:hidden}.img{overflow:hidden;background-color:#f9f9f9}.img>img{margin:0;width:100%;height:100%}.sixteen-nine{position:relative}.sixteen-nine::before{display:block;content:"";width:100%;padding-top:56.25%}.sixteen-nine>*{position:absolute;top:0;left:0;right:0;bottom:0}h1+hr,h2+hr,h3+hr,h4+hr,h5+hr,h6+hr{margin-top:0}.fade-in{animation-duration:500ms;animation-name:fade-in;animation-fill-mode:forwards}@keyframes fade-in{from{transform:translateY(-2rem);opacity:0}50%{transform:translateY(-2rem);opacity:0}to{transform:translateY(0);opacity:1}}.mb6{margin-bottom:10rem}.sidebar{color:rgba(255,255,255,0.75);text-align:left}.sidebar::before{content:"";position:absolute;z-index:2;top:0;left:0;bottom:0;right:0;background:linear-gradient(to bottom, rgba(32,32,32,0) 0%, rgba(32,32,32,0.5) 100%)}.sidebar a{color:#fff;border-bottom-color:rgba(255,255,255,0.2)}.right-side{width:100%;margin-left:auto;margin-right:auto}.right-side .ad-first{text-align:center}@media screen{.right-side{max-width:38rem;min-height:100vh}.right-side .ad-second{display:none}}@media screen and (min-width: 54em){.right-side{margin-left:20rem;margin-right:1rem;padding:4rem 1rem 12rem}.right-side .ad-second{text-align:center;display:block}}@media screen and (min-width: 72em){.right-side{margin-left:22rem;max-width:42rem}}@media screen and (min-width: 88em){.right-side{width:162px;margin-left:0rem;margin-right:0rem;padding:0rem;margin-top:10rem;display:block;float:left}}@media screen and (min-width: 96em){.right-side{width:300px;margin-right:0rem}}#_yDrawer{position:relative}@media screen{#_yDrawer{min-height:640px;min-height:100vh}}@media screen and (min-width: 54em){#_yDrawer{width:18rem;margin-left:0}}.sidebar-bg{position:absolute;height:100%;overflow:hidden;top:0;right:0;bottom:0;left:0;background:#202020 center / cover}.sidebar-box{display:flex;justify-content:center}.sidebar-sticky{position:relative;z-index:3}@media screen{.sidebar-sticky{-ms-overflow-style:none;overflow:-moz-scrollbars-none;height:100%;overflow:auto;position:absolute;padding:3rem 0rem;right:2.5rem;left:2.5rem}}.sidebar-sticky::-webkit-scrollbar{display:none}.sidebar-about>h1{color:#fff;font-size:2rem}.sidebar-nav>ul{list-style:none;padding-left:0;margin-bottom:.5rem}a.sidebar-nav-item{width:100%;font-weight:normal;display:block;line-height:1.75;padding:.25rem 0;border-bottom:1px solid rgba(255,255,255,0.2)}a.sidebar-nav-subitem{font-weight:normal;display:block;line-height:1.75;padding:.25rem 0;border-bottom:1px solid rgba(255,255,255,0.2)}@media screen{.y-drawer-scrim{z-index:2}.y-drawer-content{width:18rem;left:-18rem;z-index:3}}.sidebar-social{margin-bottom:.5rem}.sidebar-social>ul{list-style:none;padding-left:0;margin:0 -.25rem}.sidebar-social>ul>li{float:left}.sidebar-social>ul>li>a{display:inline-block;text-align:center;font-size:1.6rem;line-height:3rem;width:3.1249rem;height:4rem;padding:.5rem 0}.sidebar-social>ul li+li{margin-top:0}.fixed-top{position:fixed;top:0;left:0;width:100%;z-index:1}.navbar>.content{padding-top:0;padding-bottom:0;min-height:0;height:0}.menu{display:inline-block;padding:1.75rem 1.5rem;border-bottom:none;margin-left:-1.5rem;color:#9a9a9a !important}.menu::after{content:"\2630"}@media screen and (min-width: 54em){.menu{padding:1.25rem 1.5rem;position:absolute;left:-9999px}.menu:focus{position:static}}.animation-main{pointer-events:none}.loading{display:none}@media print{.menu{display:none}}.animation-main{opacity:0;will-change:opacity}.loading{position:absolute;top:0;right:0;padding:5.25rem 4.5rem;transform-origin:top right;transform:scale(0.33)}.content{position:relative;margin-left:auto;margin-right:auto;padding:5rem 1rem 12rem}@media screen{.content{min-height:100vh}}@media screen and (min-width: 54em){.content{padding:4rem 1rem 12rem;margin-left:19rem;margin-right:3rem}}@media screen and (min-width: 72em){.content{max-width:42rem;margin-left:21rem}}@media screen and (min-width: 88em){.content{float:left;width:100%;margin-left:22rem;margin-right:5rem}}@media screen and (min-width: 96em){.content{max-width:44rem}}@media screen and (min-width: 102em){.content{margin-left:25rem;margin-right:8rem}}.me{width:6.5rem;height:6.5rem;align-self:center;margin-right:20px;border-radius:100%;position:relative}@media screen and (min-width: 40em){.me{width:7rem;height:7rem}}@media screen and (min-width: 54em){.me{width:6.5rem;height:6.5rem}}@media screen and (min-width: 72em){.me{width:7rem;height:7rem}}main>footer{width:100%;position:absolute;bottom:0;left:0;right:0;padding:0 1rem;color:#9a9a9a;font-size:smaller;text-align:center}main>footer>p{margin-bottom:0}html{font-family:'Sans-serif'}h1,h2,h3,h4,h5,h6,.h1,.h2,.h3,.h4,.h5,.h6,.heading{font-family:'Sans-serif'}

</style>


<link
  rel="preload"
  href="http://localhost:4000/assets/css/hydejack.css?v=6.4.0"
  as="style"
  onload="this.rel='stylesheet'"
/>

<style id="_pageStyle">

.content a{color:#4f86aa;border-color:rgba(79,134,170,0.2)}.content a:hover{border-color:#4f86aa}:focus{outline-color:#4f86aa}::selection{color:#fff;background:#4f86aa}::-moz-selection{color:#fff;background:#4f86aa}

</style>


<noscript>
  <link rel="stylesheet" href="http://localhost:4000/assets/css/hydejack.css?v=6.4.0" />
    
  
  <link
    rel="stylesheet"
    href="https://fonts.googleapis.com/css?family=Lato"
  />
  <style>
    html { font-family: 'Lato', 'Sans-serif' }
    h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6, .heading { font-family: 'Lato', 'Sans-serif' }
  </style>
   
  <link rel="stylesheet" href="http://localhost:4000/assets/icomoon/style.css" />
</noscript>
<!--<![endif]-->

</head>

<body>
  <!-- =============== -->
<!-- MENU            -->
<!-- =============== -->
<div class="navbar fixed-top">
  <div class="content">
    <span class="sr-only">Jump to:</span>
    <a id="_menu" class="menu no-hover" href="#_title">
      <span class="sr-only">Menu</span>
    </a>
  </div>
</div>

<!-- =============== -->
<!-- CONTENT         -->
<!-- =============== -->
<div id="_yPushState">
  <div class="fade-in">
    <main id="_main" class="content" role="main" data-color="#4f86aa" data-image="/assets/img/kumo.jpg">
      

<article id="post-ios/2019/12/14/iOS-DesignPattern-02" class="post" role="article">
  <header>
    <h1 class="post-title">
      
        DAO Pattern
        
    </h1>

    <p class="post-date heading">
      <time datetime="2019-12-14T00:00:00+09:00">14 Dec 2019</time>
      









in <a href="/category/ios/" data-flip="title">iOS</a>

      









on <a href="/tag/ios-%EB%94%94%EC%9E%90%EC%9D%B8%ED%8C%A8%ED%84%B4/" data-flip="title">디자인패턴</a>

    </p>

    
  <div class="hr" style="padding-bottom:0"></div>


  </header>
  


  
  <div class="markdown-body">

    <!--  -->
    <style>
      .myAd1190 {
        width: 48%;
        height: 280px;
      }

      .myAd1290 {
        width: 48%;
        height: 280px;
      }

      @media(max-width: 800px) {
        .myAd1190 {
          display: none;
        }

        .myAd1290 {
          width: 98%;
        }
      }

      .row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        height: 300px;
      }

      .row-center {
        display: flex;
        justify-content: center;
        height: 258px;
      }
    </style>
   
    <!--<br />-->
    <h1 id="dao-패턴이란">DAO 패턴이란?</h1>

<p><strong>Data Access Object</strong> 의 약자로 전체 비지니스 로직 중에서 데이터베이스에 SQL문을 전송하여 질의하거나 업데이트하는 로직만 <strong>분리</strong> 하여 별도의 독립적인 클래스로 구현한 것을 가리킨다. 이 구조는 객체 지향 프로그래밍에서 자주 사용되는 패턴중 하나로, 뷰 및 비지니스 로직 계층과 데이터베이스 처리 계층을 구분하여 명확하게 역할을 분담해 줄 뿐만 아니라 전체 코드를 단순화 하는 장점이 있다.
모든 데이터베이스 프로그래밍에서 사용되는 소프트웨어 구조 패턴이다.</p>

<h2 id="dao-클래스">DAO 클래스</h2>

<p>DAO 패턴에 따라 독립적으로 구현된 클래스를 DAO 클래스라고 하며, 주로 소스파일 이름뒤에 “DAO” 접미사가 붙는 것으로 명시한다.
DAO클래스가 되기 위해 만족해야하는 특별한 조건이나 인터페이스는 정해진 것이 없다.
MVC 패턴에서 역할에 따라 각각의 클래스가 Model-View-Controller로 나뉘어 지듯이 DAO 클래스 역시 역할에 의해 구분되는 클래스이다.</p>

<h2 id="dao-class-구현">DAO Class 구현</h2>

<p>부서DAO 클래스를 우선 생성한다.</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="kd">class</span> <span class="kt">DepartmentDAO</span> <span class="p">{</span>
	<span class="c1">//부서 정보를 담을 튜플 타입 정의</span>
    <span class="kd">typealias</span> <span class="kt">DepartRecord</span> <span class="o">=</span> <span class="p">(</span><span class="kt">Int</span><span class="p">,</span> <span class="kt">String</span><span class="p">,</span> <span class="kt">String</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>
</div>

<p>부서(Department) 정보는 부서코드, 부서명, 부서 주소로 구성된다. 이들 값은 서로 연관성을 가지므로 각각의 변수로 정의하기보다는 컨테이너 타입의 객체에 담아 사용하는 것이 훨씬 효율적이다.</p>

<blockquote>
  <p>왜 튜플(Tuple)타입으로 정의하는가?</p>
</blockquote>

<p>딕셔너리에 담기에는 타입이 다양하고, VO 패턴의 객체로 정의하기에는 너무 작업이 번거로워 질 수 있기 때문이다. 튜플은 복잡한 코드 작성 없이도 다양한 데이터를 간편하게 묶을 수 있는 매우 효율적인 자료구조이다.</p>

<blockquote>
  <p>튜플의 특징</p>
</blockquote>

<ul>
  <li>다양한 타입을 저장할수 있다.</li>
  <li>첨자 타입의 속성이 제공되지만, 메소드나 속성, subScript는 제공되지 않는다.</li>
  <li>한번 입력된 튜플값의 변경은 불가능하다.</li>
  <li>기능을 정의하는 클래스나 구조체가 존재하지 않는다.</li>
</ul>

<p>그렇기 때문에 여러곳에서 참조해야할 경우라면 Tuple타입을 <code class="highlighter-rouge">typealias</code>와 함께 사용하는것이 효과적이다.</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="kd">class</span> <span class="kt">DepartmentDAO</span> <span class="p">{</span>
    
    <span class="c1">// SQLite 연결 및 초기화</span>
    <span class="kd">lazy</span> <span class="k">var</span> <span class="nv">fmdb</span><span class="p">:</span> <span class="kt">FMDatabase</span><span class="o">!</span> <span class="o">=</span> <span class="p">{</span>
        <span class="c1">// 1. 파일 매니저 객체 생성</span>
        <span class="k">let</span> <span class="nv">fileMgr</span> <span class="o">=</span> <span class="kt">FileManager</span><span class="o">.</span><span class="k">default</span>
        
        <span class="c1">// 2. 샌드박스 내 문서 디렉터리에서 데이터베이스 파일 경로를 확인</span>
        <span class="k">let</span> <span class="nv">docPath</span> <span class="o">=</span> <span class="n">fileMgr</span><span class="o">.</span><span class="nf">urls</span><span class="p">(</span><span class="nv">for</span><span class="p">:</span> <span class="o">.</span><span class="n">documentDirectory</span><span class="p">,</span> <span class="nv">in</span><span class="p">:</span> <span class="o">.</span><span class="n">userDomainMask</span><span class="p">)</span><span class="o">.</span><span class="n">first</span>
        
        <span class="k">let</span> <span class="nv">dbPath</span> <span class="o">=</span> <span class="n">docPath</span><span class="o">!.</span><span class="nf">appendingPathComponent</span><span class="p">(</span><span class="s">"hr.sqlite"</span><span class="p">)</span><span class="o">.</span><span class="n">path</span>
        
        <span class="c1">// 3. 샌드박스 경로에 파일이 없다면 메인 번들에 만들어 둔 hr.sqlite를 가져와 복사한다</span>
        <span class="k">if</span> <span class="n">fileMgr</span><span class="o">.</span><span class="nf">fileExists</span><span class="p">(</span><span class="nv">atPath</span><span class="p">:</span> <span class="n">dbPath</span><span class="p">)</span> <span class="o">==</span> <span class="kc">false</span> <span class="p">{</span>
            <span class="k">let</span> <span class="nv">dbSource</span> <span class="o">=</span> <span class="kt">Bundle</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="nf">path</span><span class="p">(</span><span class="nv">forResource</span><span class="p">:</span> <span class="s">"hr"</span><span class="p">,</span> <span class="nv">ofType</span><span class="p">:</span> <span class="s">"sqlite"</span><span class="p">)</span>
            <span class="k">try!</span> <span class="n">fileMgr</span><span class="o">.</span><span class="nf">copyItem</span><span class="p">(</span><span class="nv">atPath</span><span class="p">:</span> <span class="n">dbSource</span><span class="o">!</span><span class="p">,</span> <span class="nv">toPath</span><span class="p">:</span> <span class="n">dbPath</span><span class="p">)</span>
        <span class="p">}</span>
        
        <span class="c1">// 4. 준비된 데이터베이스 파일을 바탕으로 FMDatabase객체를 생성한다</span>
        <span class="k">let</span> <span class="nv">db</span> <span class="o">=</span> <span class="kt">FMDatabase</span><span class="p">(</span><span class="nv">path</span><span class="p">:</span> <span class="n">dbPath</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">db</span>
        
    <span class="p">}()</span>
    
    <span class="c1">//생성자 소멸자를 정의 -&gt; 데이터베이스 연결을 열고 닫는다</span>
    <span class="nf">init</span><span class="p">()</span> <span class="p">{</span>
    	<span class="k">self</span><span class="o">.</span><span class="n">fmdb</span><span class="o">.</span><span class="nf">open</span><span class="p">()</span>
	<span class="p">}</span>
    <span class="kd">deinit</span> <span class="p">{</span>
   		<span class="k">self</span><span class="o">.</span><span class="n">fmdb</span><span class="o">.</span><span class="nf">close</span><span class="p">()</span>
	<span class="p">}</span>        
<span class="p">}</span>
</code></pre>
</div>

<ul>
  <li>파일 매니저 객체를 생성한다.</li>
  <li>샌드박스 내 문서 디렉터리에서 데이터베이스 파일의 경로를 추출한다.</li>
  <li>해당 경로에 파일이 없다면 메인번들에 만들어둔 ht.sqlite 파일을 가져와 샌드박스에 복사한다</li>
  <li>두번째또는 세번째 과정을 통해 샌드박스에 준비된 hr.sqlite 파일을 이용하여 FMDatabase 객체를 생성한다.</li>
</ul>

<blockquote>
  <p>부서 목록을 읽어올 메소드 find</p>
</blockquote>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code> <span class="kd">func</span> <span class="nf">find</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="kt">DepartRecord</span><span class="p">]</span> <span class="p">{</span>
        <span class="k">var</span> <span class="nv">departList</span> <span class="o">=</span> <span class="p">[</span><span class="kt">DepartRecord</span><span class="p">]()</span>
        
        <span class="k">do</span> <span class="p">{</span>
            <span class="c1">// 1. 부서 정보 목록을 가져올 SQL 작성 및 쿼리 실행</span>
            <span class="k">let</span> <span class="nv">sql</span> <span class="o">=</span> <span class="s">"""
                SELECT depart_cd, depart_title, depart_addr
                FROM department
                ORDER BY depart_cd ASC
                """</span>
            
            <span class="k">let</span> <span class="nv">rs</span> <span class="o">=</span> <span class="k">try</span> <span class="k">self</span><span class="o">.</span><span class="n">fmdb</span><span class="o">.</span><span class="nf">excuteQuery</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="nv">values</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
            <span class="c1">// 2. 결과 집합 추출</span>
            
            <span class="k">while</span> <span class="n">rs</span><span class="o">.</span><span class="nf">next</span><span class="p">()</span> <span class="p">{</span>
                <span class="k">let</span> <span class="nv">departCd</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="nf">int</span><span class="p">(</span><span class="nv">forColumn</span><span class="p">:</span> <span class="s">"depart_cd"</span><span class="p">)</span>
                <span class="k">let</span> <span class="nv">departTitle</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="nf">string</span><span class="p">(</span><span class="nv">forColumn</span><span class="p">:</span> <span class="s">"depart_title"</span><span class="p">)</span>
                <span class="k">let</span> <span class="nv">departAddr</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="nf">string</span><span class="p">(</span><span class="nv">forColumn</span><span class="p">:</span> <span class="s">"depart_addr"</span><span class="p">)</span>
                
                <span class="c1">// append 메소드 호출 시 아래 튜플을 괄호 없이 사용하지 않도록 주의</span>
                <span class="n">departList</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span> <span class="p">(</span><span class="kt">Int</span><span class="p">(</span><span class="n">departCd</span><span class="p">),</span> <span class="n">departTitle</span><span class="o">!</span><span class="p">,</span> <span class="n">departAddr</span><span class="o">!</span><span class="p">))</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="k">let</span> <span class="nv">error</span> <span class="k">as</span> <span class="kt">NSError</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"failed: </span><span class="se">\(</span><span class="n">error</span><span class="o">.</span><span class="n">localizedDescription</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">departList</span>
    <span class="p">}</span>
</code></pre>
</div>

<blockquote>
  <p>단일 부서 정보를 읽어올 메서드 get (=select)</p>
</blockquote>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code> <span class="kd">func</span> <span class="nf">get</span><span class="p">(</span><span class="nv">departCd</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">DepartRecode</span><span class="p">?</span> <span class="p">{</span>
        
        <span class="c1">// 1. 쿼리 수행</span>
        <span class="k">let</span> <span class="nv">sql</span> <span class="o">=</span> <span class="s">"""
            SELECT depart_cd, depart_title, depart_addr
            FROM department
            WHERE depart_cd = ?
            """</span>
        
        <span class="k">let</span> <span class="nv">rs</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="n">fmdb</span><span class="o">.</span><span class="nf">executeQuery</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="nv">withArgumentsIn</span><span class="p">:</span> <span class="p">[</span><span class="n">departCd</span><span class="p">])</span>
        
        <span class="c1">// 결과 집합 처리</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">_rs</span> <span class="o">=</span> <span class="n">rs</span> <span class="p">{</span>   <span class="c1">// 결과 집합이 옵셔널 타입으로 반환되므로, 이를 일반 상수에 바인딩 하여 해제한다.</span>
            <span class="n">_rs</span><span class="o">.</span><span class="nf">next</span><span class="p">()</span>
            
            <span class="k">let</span> <span class="nv">departId</span> <span class="o">=</span> <span class="n">_rs</span><span class="o">.</span><span class="nf">int</span><span class="p">(</span><span class="nv">forColumn</span><span class="p">:</span> <span class="s">"depart_cd"</span><span class="p">)</span>
            <span class="k">let</span> <span class="nv">departTitle</span> <span class="o">=</span> <span class="n">_rs</span><span class="o">.</span><span class="nf">string</span><span class="p">(</span><span class="nv">forColumn</span><span class="p">:</span> <span class="s">"depart_title"</span><span class="p">)</span>
            <span class="k">let</span> <span class="nv">departAddr</span> <span class="o">=</span> <span class="n">_rs</span><span class="o">.</span><span class="nf">string</span><span class="p">(</span><span class="nv">forColumn</span><span class="p">:</span> <span class="s">"depart_addr"</span><span class="p">)</span>
            
            <span class="nf">return</span> <span class="p">(</span><span class="kt">Int</span><span class="p">(</span><span class="n">departId</span><span class="p">),</span> <span class="n">departTitle</span><span class="o">!</span><span class="p">,</span> <span class="n">departAddr</span><span class="o">!</span><span class="p">)</span>
            
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">nil</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre>
</div>

<blockquote>
  <p>부서 정보 추가 메서드 create (= insert)</p>
</blockquote>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code>    <span class="kd">func</span> <span class="nf">create</span><span class="p">(</span><span class="nv">title</span><span class="p">:</span> <span class="kt">String</span><span class="o">!</span><span class="p">,</span> <span class="nv">addr</span><span class="p">:</span> <span class="kt">String</span><span class="o">!</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
        <span class="k">do</span> <span class="p">{</span>
            <span class="k">let</span> <span class="nv">sql</span> <span class="o">=</span> <span class="s">"""
                INSERT INTO department (depart_title, depart_addr)
                VALUES( ? , ? )
            """</span>
            <span class="k">try</span> <span class="k">self</span><span class="o">.</span><span class="n">fmdb</span><span class="o">.</span><span class="nf">executeUpdate</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="nv">values</span><span class="p">:</span> <span class="p">[</span><span class="n">title</span><span class="p">,</span> <span class="n">addr</span><span class="p">])</span>
            <span class="k">return</span> <span class="kc">true</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="k">let</span> <span class="nv">error</span> <span class="k">as</span> <span class="kt">NSError</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"Insert Error: </span><span class="se">\(</span><span class="n">error</span><span class="o">.</span><span class="n">localizedDescription</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">false</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre>
</div>

<blockquote>
  <p>부서 정보 삭제 remove (= delete)</p>
</blockquote>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code>    <span class="kd">func</span> <span class="nf">remove</span><span class="p">(</span><span class="nv">departCd</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
        <span class="k">do</span> <span class="p">{</span>
            <span class="k">let</span> <span class="nv">sql</span> <span class="o">=</span> <span class="s">"DELETE FORM department WHERE depart_cd?"</span>
            <span class="k">try</span><span class="o">.</span><span class="k">self</span><span class="o">.</span><span class="n">fmdb</span><span class="o">.</span><span class="nf">executeUpdate</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="nv">values</span><span class="p">:</span> <span class="p">[</span><span class="n">departCd</span><span class="p">])</span>
            <span class="k">return</span> <span class="kc">true</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="k">let</span> <span class="nv">error</span> <span class="k">as</span> <span class="kt">NSError</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="s">"DELETE Error : </span><span class="se">\(</span><span class="n">error</span><span class="o">.</span><span class="n">localizedDescription</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">false</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre>
</div>


    <br />
    <br />
  </div>
  

</article>

<!--<hr class="dingbat" />-->
<!--
<div class="share">
  <h2>Share this post</h2>
  <div class="share-body">
    <a href="http://twitter.com/share?text=DAO Pattern&amp;url=http://localhost:4000/ios/2019/12/14/iOS-DesignPattern-02/"
      onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
      <span class="icon-twitter">
      </span>
    </a>
    <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/ios/2019/12/14/iOS-DesignPattern-02/"
      onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
      <span class="icon-facebook">
      </span>
    </a>
  </div>
</div>
-->
<br />






  <aside class="author" role="complementary">
    <div class="author">
  <h2 class="page-title hr">
    About
  </h2>
<div class="author-body">
  
    
  

  

  <img
    src="/assets/img/me.jpg"
    class="me"
    alt="youngjun gu"
    srcset="/assets/img/me.jpg 1x,/assets/img/me.jpg 2x"
    
  />


  
  <div class="author-body-description">
    <p>오늘을 기록하고 내일을 코딩하는 개발자</p>

  </div>
</div>
</div>

  </aside>




<aside class="related" role="complementary">
  <h2 class="hr">Related Posts</h2>

  <ul class="related-posts">
    
      
      
      
        
        
          


<li class="h4">
  <a href="/ios/2020/06/29/iOS-Basic-xib%EC%82%AC%EC%9A%A9%EB%B2%95/" data-flip="title">
    <span>xib를 통해 CustomView 만들기 & xib와 nib의 차이</span>
  </a>
  <small><time datetime="2020-06-29T00:00:00+09:00">
    29 Jun 2020
  </time></small>
</li>

        
      
        
        
          


<li class="h4">
  <a href="/ios/2020/06/29/iOS-Basic-maskToBounds&clipsToBounds/" data-flip="title">
    <span>masksToBounds 와 clipsToBounds의 차이점</span>
  </a>
  <small><time datetime="2020-06-29T00:00:00+09:00">
    29 Jun 2020
  </time></small>
</li>

        
      
        
        
          


<li class="h4">
  <a href="/ios/2020/05/28/iOS-Basic-15/" data-flip="title">
    <span>SwiftGen</span>
  </a>
  <small><time datetime="2020-05-28T00:00:00+09:00">
    28 May 2020
  </time></small>
</li>

        
      
        
        
      
    
  </ul>
</aside>


      
        <aside class="comments" role="complementary">
  <h2>Comments</h2>
  <hr/>

  <div id="disqus_thread"></div>

  <script>
    !function(s,i){function e(e){var t=s.pageYOffset||i.body.scrollTop;s.DISQUS&&!s._disqusThis&&!s._disqusFirst&&t+s.innerHeight>=s._disqusThreadOffsetTop&&(s._disqusThis=!0,s.DISQUS.reset({reload:!0,config:d}))}var d=function(){this.page.title="DAO Pattern",this.page.identifier="/ios/2019/12/14/iOS-DesignPattern-02",this.page.url="http://localhost:4000/ios/2019/12/14/iOS-DesignPattern-02/"};s._disqusFirst=void 0===s._disqusFirst||s._disqusFirst,s._disqusLoading=void 0!==s._disqusLoading&&s._disqusLoading,s._disqusThis=!1,s._disqusThreadOffsetTop=i.getElementById("disqus_thread").offsetTop,s._disqusLoading?s._disqusFirst=!1:(s._disqusLoading=!0,loadJSDeferred("//gaki.disqus.com/embed.js"),s.addEventListener?s.addEventListener("scroll",e,{passive:!0}):s.attachEvent?s.attachEvent("onscroll",e):s.onscroll=e)}(window,document);

  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
</aside>

      

      <footer>
  <hr/>
  
    <p>© 2020. by Gaki</p>

  
  <p>
    <code>Powered by <a href="https://gaki2745.github.io/">gaki</a></code>
  </p>
</footer>

    </main>
    <div class="right-side">
  <br />
  <br />
</div>

  </div>
  <div id="_yDrawer">
  <div id="_sidebar" class="sidebar">
    <div class="sidebar-bg" style="background-color:#4f86aa;background-image:url(/assets/img/kumo.jpg)"></div>
    <header class="sidebar-sticky" role="banner">
      <br/>
      <div class="sidebar-about">
        <h1><a id="_title" href="/">Gaki</a></h1>
        <p>오늘을 기록하고 내일을 코딩하는 iOS 개발자</p>

      </div>

      <br/>
      <br/>
      <nav class="sidebar-nav heading" role="navigation">
        <span class="sr-only">Navigation:</span>
<ul>
  

  

  
  
  
  
  
    <li>
      <input type="checkbox" id="list-item-1"/>
      <div  class="list-wrapper">
      <a class="sidebar-nav-item" href="/category/ios/">iOS</a>
       <label class="folder" for="list-item-1">▾</label>
    </div>
     <ul class="list-body">
       
           
         
           
         
           
         
           
         
           
         
           
         
           
             <li>
               <a class="sidebar-nav-subitem" href="/tag/ios-basic/">Basic</a>
             </li>
           
         
           
         
           
         
           
             <li>
               <a class="sidebar-nav-subitem" href="/tag/ios-%EB%94%94%EC%9E%90%EC%9D%B8%ED%8C%A8%ED%84%B4/">디자인패턴</a>
             </li>
           
         
           
         
           
             <li>
               <a class="sidebar-nav-subitem" href="/tag/ios-%EC%95%84%ED%82%A4%ED%85%8D%EC%B3%90%ED%8C%A8%ED%84%B4/">아키텍쳐패턴</a>
             </li>
           
         
           
             <li>
               <a class="sidebar-nav-subitem" href="/tag/ios-%ED%85%8C%EC%8A%A4%ED%8C%85/">테스팅</a>
             </li>
           
         
           
             <li>
               <a class="sidebar-nav-subitem" href="/tag/ios-ui%EB%94%94%EC%9E%90%EC%9D%B8/">UI디자인</a>
             </li>
           
         
           
             <li>
               <a class="sidebar-nav-subitem" href="/tag/ios-arkit/">ARKit</a>
             </li>
           
         
           
             <li>
               <a class="sidebar-nav-subitem" href="/tag/ios-avfoundation/">AVFoundation</a>
             </li>
           
         
           
             <li>
               <a class="sidebar-nav-subitem" href="/tag/ios-pop/">POP</a>
             </li>
           
         
     </ul>
    </li>

  
  
    <li>
      <input type="checkbox" id="list-item-2"/>
      <div  class="list-wrapper">
      <a class="sidebar-nav-item" href="/category/swift/">Swift</a>
       <label class="folder" for="list-item-2">▾</label>
    </div>
     <ul class="list-body">
       
           
         
           
         
           
         
           
             <li>
               <a class="sidebar-nav-subitem" href="/tag/swift-basic/">Basic</a>
             </li>
           
         
           
         
           
         
           
         
           
             <li>
               <a class="sidebar-nav-subitem" href="/tag/swift-rxswift/">RxSwift</a>
             </li>
           
         
           
         
           
         
           
             <li>
               <a class="sidebar-nav-subitem" href="/tag/swift-oop/">OOP</a>
             </li>
           
         
           
         
           
         
           
         
           
         
           
         
           
         
     </ul>
    </li>

  
  
    <li>
      <input type="checkbox" id="list-item-3"/>
      <div  class="list-wrapper">
      <a class="sidebar-nav-item" href="/category/algorithm/">Algorithm</a>
       <label class="folder" for="list-item-3">▾</label>
    </div>
     <ul class="list-body">
       
           
             <li>
               <a class="sidebar-nav-subitem" href="/tag/algorithm-problem/">문제풀이</a>
             </li>
           
         
           
             <li>
               <a class="sidebar-nav-subitem" href="/tag/algorithm-swiftalgorithm/">SwiftAlgorithm</a>
             </li>
           
         
           
         
           
         
           
         
           
         
           
         
           
         
           
         
           
         
           
         
           
         
           
         
           
         
           
         
           
         
           
         
     </ul>
    </li>

  
  
    <li>
      <input type="checkbox" id="list-item-4"/>
      <div  class="list-wrapper">
      <a class="sidebar-nav-item" href="/category/swiftui/">SwiftUI</a>
       <label class="folder" for="list-item-4">▾</label>
    </div>
     <ul class="list-body">
       
           
         
           
         
           
         
           
         
           
             <li>
               <a class="sidebar-nav-subitem" href="/tag/swiftui-combine/">Combine</a>
             </li>
           
         
           
         
           
         
           
         
           
         
           
         
           
         
           
         
           
         
           
         
           
         
           
         
           
         
     </ul>
    </li>

  
  
    <li>
      <input type="checkbox" id="list-item-5"/>
      <div  class="list-wrapper">
      <a class="sidebar-nav-item" href="/category/wwdc/">WWDC</a>
       <label class="folder" for="list-item-5">▾</label>
    </div>
     <ul class="list-body">
       
           
         
           
         
           
         
           
         
           
         
           
             <li>
               <a class="sidebar-nav-subitem" href="/tag/wwdc-2019/">2019</a>
             </li>
           
         
           
         
           
         
           
         
           
         
           
         
           
         
           
         
           
         
           
         
           
         
           
         
     </ul>
    </li>

  
  
    <li>
      <input type="checkbox" id="list-item-6"/>
      <div  class="list-wrapper">
      <a class="sidebar-nav-item" href="/category/life/">Life</a>
       <label class="folder" for="list-item-6">▾</label>
    </div>
     <ul class="list-body">
       
           
         
           
         
           
             <li>
               <a class="sidebar-nav-subitem" href="/tag/life-review/">후기</a>
             </li>
           
         
           
         
           
         
           
         
           
         
           
         
           
             <li>
               <a class="sidebar-nav-subitem" href="/tag/life-retrospect/">회고</a>
             </li>
           
         
           
         
           
         
           
         
           
         
           
         
           
         
           
         
           
         
     </ul>
    </li>

  
  
    <li>
      <input type="checkbox" id="list-item-7"/>
      <div  class="list-wrapper">
      <a class="sidebar-nav-item" href="/about/">About</a>
       
    </div>
     <ul class="list-body">
       
           
         
           
         
           
         
           
         
           
         
           
         
           
         
           
         
           
         
           
         
           
         
           
         
           
         
           
         
           
         
           
         
           
         
     </ul>
    </li>

  
</ul>

      </nav>
    <br/>
    <br/>
      <div class="sidebar-box">
        
          
  

  

  <img
    src="/assets/img/me.jpg"
    class="me"
    alt="youngjun gu"
    srcset="/assets/img/me.jpg 1x,/assets/img/me.jpg 2x"
    
  />


        
      </div>
      <p>Be Faithful to the Basic!!</p>

      
      
        <div class="sidebar-social">
          <span class="sr-only">Social:</span>
<ul>
  
    









<li>
  <a href="https://facebook.com/yeongjun.gu">
    <span class="icon-facebook" title="Facebook"></span>
    <span class="sr-only">Facebook</span>
  </a>
</li>

  
    









<li>
  <a href="https://github.com/gaki2745">
    <span class="icon-github" title="GitHub"></span>
    <span class="sr-only">GitHub</span>
  </a>
</li>

  
    









<li>
  <a href="mailto:guyeongjun@naver.com">
    <span class="icon-mail" title="Email"></span>
    <span class="sr-only">Email</span>
  </a>
</li>

  
    









<li>
  <a href="https://gaki2745.github.io/feed.xml">
    <span class="icon-rss2" title="RSS"></span>
    <span class="sr-only">RSS</span>
  </a>
</li>

  
</ul>

        </div>
      
    </header>
  </div>
</div>
</div>

<!-- =============== -->
<!-- SCRIPTS         -->
<!-- =============== -->

<script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-92346434-1', 'auto');
  ga('send', 'pageview');
  loadJSDeferred('https://www.google-analytics.com/analytics.js');
</script>





<!--[if gt IE 8]><!---->
<script src="//ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js"></script>
<script>
  WebFont.load({
    
    google: {
      families: 'Lato'.split('|')
    },
    

    custom: {
      families: ['icomoon'],
      urls: ['/assets/icomoon/style.css']
    }
  });
</script>
<!--<![endif]-->


  <!--[if gt IE 9]><!---->
  
  <script>loadJSDeferred('/assets/js/hydejack.js?v=6.4.0');</script>

  
  <!--<![endif]-->



</body>

</html>
