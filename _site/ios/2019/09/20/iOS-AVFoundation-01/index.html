<!DOCTYPE html>
<html lang="en"><!--
 __  __                __                                     __
/\ \/\ \              /\ \             __                    /\ \
\ \ \_\ \   __  __    \_\ \      __   /\_\      __       ___ \ \ \/'\
 \ \  _  \ /\ \/\ \   /'_` \   /'__`\ \/\ \   /'__`\    /'___\\ \ , <
  \ \ \ \ \\ \ \_\ \ /\ \L\ \ /\  __/  \ \ \ /\ \L\.\_ /\ \__/ \ \ \\`\
   \ \_\ \_\\/`____ \\ \___,_\\ \____\ _\ \ \\ \__/.\_\\ \____\ \ \_\ \_\
    \/_/\/_/ `/___/> \\/__,_ / \/____//\ \_\ \\/__/\/_/ \/____/  \/_/\/_/
                /\___/                \ \____/
                \/__/                  \/___/

Powered by Hydejack v6.4.0 (https://qwtel.com/hydejack/)
-->









<head>
  <!-- =============== -->
<!-- META            -->
<!-- =============== -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta name="format-detection" content="telephone=no" />
<meta http-equiv="x-ua-compatible" content="ie=edge" />
<meta
  name="naver-site-verification"
  content="22c5b4ef3bfda7fc6100671413989219de7a4ac8"
/>
<meta property="og:title" content="iOS AVFoundation" />
<meta property="og:type" content="article" />

<!-- =============== -->
<!-- Google AdSense  -->
<!-- =============== -->
<script
  data-ad-client="ca-pub-8247516864622650"
  async
  src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"
></script>

 
<meta property="og:image" content="http://localhost:4000/assets/img/logo.png" />


<meta property="og:image:width" content="640" />
<meta property="og:image:height" content="360" />
 
<title>iOS AVFoundation &middot; Gaki</title>
 
<meta
  name="description"
  content="AVFoundation

"
/>
<meta
  property="og:description"
  content="AVFoundation

"
/>



<!-- =============== -->
<!-- LINKS           -->
<!-- =============== -->
<link rel="canonical" href="http://localhost:4000/ios/2019/09/20/iOS-AVFoundation-01/" />
<meta property="og:url" content="http://localhost:4000/ios/2019/09/20/iOS-AVFoundation-01/" />

<link
  rel="alternate"
  type="application/atom+xml"
  title="Gaki Feed"
  href="http://localhost:4000/feed.xml"
/>


<link rel="prev" href="http://localhost:4000/algorithm/2019/09/20/Algorithm-SwiftAlgorithm-01/" />
 
<link rel="next" href="http://localhost:4000/ios/2019/09/21/iOS-Basic-04/" />


<link
  rel="apple-touch-icon"
  href="http://localhost:4000/apple-touch-icon.png"
/>
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?" />
<!-- Place favicon.ico in the root directory -->

<!-- =============== -->
<!-- SCRIPTS         -->
<!-- =============== -->
<script>
  !function(n,e){function t(n,e){n.onload=function(){this.onerror=this.onload=null,e(null,n)},n.onerror=function(){this.onerror=this.onload=null,e(new Error("Failed to load "+this.src),n)}}function o(n,e){n.onreadystatechange=function(){"complete"!=this.readyState&&"loaded"!=this.readyState||(this.onreadystatechange=null,e(null,n))}}n._loaded=!1,n.loadJSDeferred=function(a,d){function r(){n._loaded=!0;var r=e.createElement("script");r.src=a,d&&(("onload"in r?t:o)(r,d),r.onload||t(r,d));var l=e.getElementsByTagName("script")[0];l.parentNode.insertBefore(r,l)}n._loaded?r():n.addEventListener?n.addEventListener("load",r,!1):n.attachEvent?n.attachEvent("onload",r):n.onload=r}}(window,document);

  !function(e){"use strict";var n=function(n,t,o){function i(e){if(a.body)return e();setTimeout(function(){i(e)})}function r(){l.addEventListener&&l.removeEventListener("load",r),l.media=o||"all"}var d,a=e.document,l=a.createElement("link");if(t)d=t;else{var f=(a.body||a.getElementsByTagName("head")[0]).childNodes;d=f[f.length-1]}var s=a.styleSheets;l.rel="stylesheet",l.href=n,l.media="only x",i(function(){d.parentNode.insertBefore(l,t?d:d.nextSibling)});var u=function(e){for(var n=l.href,t=s.length;t--;)if(s[t].href===n)return e();setTimeout(function(){u(e)})};return l.addEventListener&&l.addEventListener("load",r),l.onloadcssdefined=u,u(r),l};"undefined"!=typeof exports?exports.loadCSS=n:e.loadCSS=n}("undefined"!=typeof global?global:this);

  !function(t){if(t.loadCSS){var e=loadCSS.relpreload={};if(e.support=function(){try{return t.document.createElement("link").relList.supports("preload")}catch(t){return!1}},e.poly=function(){for(var e=t.document.getElementsByTagName("link"),r=0;r<e.length;r++){var n=e[r];"preload"===n.rel&&"style"===n.getAttribute("as")&&(t.loadCSS(n.href,n,n.getAttribute("media")),n.rel=null)}},!e.support()){e.poly();var r=t.setInterval(e.poly,300);t.addEventListener&&t.addEventListener("load",function(){e.poly(),t.clearInterval(r)}),t.attachEvent&&t.attachEvent("onload",function(){t.clearInterval(r)})}}}(this);

  window.disablePushState = false;
  window.disableDrawer = false;
</script>

<!--[if lt IE 9]>
  <script src="https://unpkg.com/html5shiv/dist/html5shiv.min.js"></script>
<![endif]-->

<!-- =============== -->
<!-- STYLES          -->
<!-- =============== -->
<!--[if gt IE 8]><!---->
<style>
  
  article,aside,dialog,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}mark{background:#FF0;color:#000}*{box-sizing:border-box}html,body{margin:0;padding:0}html{font-size:16px;line-height:1.75}body{color:#333;background-color:#fff;overflow-y:scroll}a{text-decoration:none}.lead{margin-left:-1rem;margin-right:-1rem}img,.img{display:block;max-width:100%;margin-bottom:1rem;border:none}img.lead,.img.lead{max-width:calc(100% + 2rem);width:calc(100% + 2rem)}h1,h2,h3,h4,h5,h6,.h1,.h2,.h3,.h4,.h5,.h6,.heading{font-weight:bold;text-rendering:optimizeLegibility}h1,h2,h3,h4,h5,h6,.h1,.h2,.h3,.h4,.h5,.h6{margin:1.6rem 0 1rem;line-height:1.6}h1,.h1{font-size:2rem;line-height:1.25}h2,.h2{font-size:1.5rem}h3,.h3{font-size:1.17em}p{margin-top:0;margin-bottom:1rem}p.lead{font-size:1.25rem;font-weight:300;padding:0 1rem}ul,ol,dl{margin-top:0;margin-bottom:1rem}ul,ol{padding-left:1.25rem}hr{position:relative;margin:1.5rem 0;border:0;border-top:1px solid #eee}.hr{padding-bottom:.5rem;border-bottom:1px solid #eee;margin-bottom:1.5rem}h4,h5,h6,.h4,.h5,.h6{margin-bottom:0.5rem;font-size:1rem}table{margin-bottom:1rem;width:100%;width:calc(100% + 2rem);margin-left:-1rem;border:1px solid #e5e5e5;border-collapse:collapse;border-spacing:0}td,th{padding:.25rem .5rem;border:1px solid #e5e5e5}td:first-child,th:first-child{padding-left:1rem}td:last-child,th:last-child{padding-right:1rem}thead+tbody,tbody+tbody,tfoot{border-top:3px double #e5e5e5}tbody tr:nth-child(odd) td,tbody tr:nth-child(odd) th{background-color:#f9f9f9}footer{margin-bottom:2rem}.page,.post{margin-bottom:3em}.page li+li,.post li+li{margin-top:.25rem}.page>header,.post>header{margin-bottom:2rem}.page-title,.post-title{margin-top:0}.post-date{display:block;margin-top:-0.5rem;margin-bottom:1rem;color:#9a9a9a}.related-posts{padding-left:0;list-style:none}.related-posts>li,.related-posts>li+li{margin-top:1rem}.related-posts>li>small,.related-posts>li+li>small{font-size:75%;color:#9a9a9a}.message{margin-bottom:1rem;padding:1rem;color:#787878;background-color:#f9f9f9;margin-left:-1rem;margin-right:-1rem}body,main{position:relative;overflow-x:hidden}@media screen{body::before{content:'';background:#e5e5e5;position:absolute;left:0;top:0;bottom:0}}@media screen and (min-width: 40em){html{font-size:17px}}@media screen and (min-width: 54em){html{font-size:16px}}@media screen and (min-width: 88em){html{font-size:17px}}@media screen and (min-width: 125em){html{font-size:18px}}.sr-only{display:none}.clearfix,.sidebar-social::after,.clearafter::after{content:"";display:table;clear:both}a,.a{position:relative;padding-bottom:.15rem;border-style:hidden}.img{overflow:hidden;background-color:#f9f9f9}.img>img{margin:0;width:100%;height:100%}.sixteen-nine{position:relative}.sixteen-nine::before{display:block;content:"";width:100%;padding-top:56.25%}.sixteen-nine>*{position:absolute;top:0;left:0;right:0;bottom:0}h1+hr,h2+hr,h3+hr,h4+hr,h5+hr,h6+hr{margin-top:0}.fade-in{animation-duration:500ms;animation-name:fade-in;animation-fill-mode:forwards}@keyframes fade-in{from{transform:translateY(-2rem);opacity:0}50%{transform:translateY(-2rem);opacity:0}to{transform:translateY(0);opacity:1}}.mb6{margin-bottom:10rem}.sidebar{color:rgba(255,255,255,0.75);text-align:left}.sidebar::before{content:"";position:absolute;z-index:2;top:0;left:0;bottom:0;right:0;background:linear-gradient(to bottom, rgba(32,32,32,0) 0%, rgba(32,32,32,0.5) 100%)}.sidebar a{color:#fff;border-bottom-color:rgba(255,255,255,0.2)}.right-side{width:100%;margin-left:auto;margin-right:auto}.right-side .ad-first{text-align:center}@media screen{.right-side{max-width:38rem;min-height:100vh}.right-side .ad-second{display:none}}@media screen and (min-width: 54em){.right-side{margin-left:20rem;margin-right:1rem;padding:4rem 1rem 12rem}.right-side .ad-second{text-align:center;display:block}}@media screen and (min-width: 72em){.right-side{margin-left:22rem;max-width:42rem}}@media screen and (min-width: 88em){.right-side{width:162px;margin-left:0rem;margin-right:0rem;padding:0rem;margin-top:10rem;display:block;float:left}}@media screen and (min-width: 96em){.right-side{width:300px;margin-right:0rem}}#_yDrawer{position:relative}@media screen{#_yDrawer{min-height:640px;min-height:100vh}}@media screen and (min-width: 54em){#_yDrawer{width:18rem;margin-left:0}}.sidebar-bg{position:absolute;height:100%;overflow:hidden;top:0;right:0;bottom:0;left:0;background:#202020 center / cover}.sidebar-box{display:flex;justify-content:center}.sidebar-sticky{position:relative;z-index:3}@media screen{.sidebar-sticky{-ms-overflow-style:none;overflow:-moz-scrollbars-none;height:100%;overflow:auto;position:absolute;padding:3rem 0rem;right:2.5rem;left:2.5rem}}.sidebar-sticky::-webkit-scrollbar{display:none}.sidebar-about>h1{color:#fff;font-size:2rem}.sidebar-nav>ul{list-style:none;padding-left:0;margin-bottom:.5rem}a.sidebar-nav-item{width:100%;font-weight:normal;display:block;line-height:1.75;padding:.25rem 0;border-bottom:1px solid rgba(255,255,255,0.2)}a.sidebar-nav-subitem{font-weight:normal;display:block;line-height:1.75;padding:.25rem 0;border-bottom:1px solid rgba(255,255,255,0.2)}@media screen{.y-drawer-scrim{z-index:2}.y-drawer-content{width:18rem;left:-18rem;z-index:3}}.sidebar-social{margin-bottom:.5rem}.sidebar-social>ul{list-style:none;padding-left:0;margin:0 -.25rem}.sidebar-social>ul>li{float:left}.sidebar-social>ul>li>a{display:inline-block;text-align:center;font-size:1.6rem;line-height:3rem;width:3.1249rem;height:4rem;padding:.5rem 0}.sidebar-social>ul li+li{margin-top:0}.fixed-top{position:fixed;top:0;left:0;width:100%;z-index:1}.navbar>.content{padding-top:0;padding-bottom:0;min-height:0;height:0}.menu{display:inline-block;padding:1.75rem 1.5rem;border-bottom:none;margin-left:-1.5rem;color:#9a9a9a !important}.menu::after{content:"\2630"}@media screen and (min-width: 54em){.menu{padding:1.25rem 1.5rem;position:absolute;left:-9999px}.menu:focus{position:static}}.animation-main{pointer-events:none}.loading{display:none}@media print{.menu{display:none}}.animation-main{opacity:0;will-change:opacity}.loading{position:absolute;top:0;right:0;padding:5.25rem 4.5rem;transform-origin:top right;transform:scale(0.33)}.content{position:relative;margin-left:auto;margin-right:auto;padding:5rem 1rem 12rem}@media screen{.content{min-height:100vh}}@media screen and (min-width: 54em){.content{padding:4rem 1rem 12rem;margin-left:19rem;margin-right:3rem}}@media screen and (min-width: 72em){.content{max-width:42rem;margin-left:21rem}}@media screen and (min-width: 88em){.content{float:left;width:100%;margin-left:22rem;margin-right:5rem}}@media screen and (min-width: 96em){.content{max-width:44rem}}@media screen and (min-width: 102em){.content{margin-left:25rem;margin-right:8rem}}.me{width:6.5rem;height:6.5rem;align-self:center;margin-right:20px;border-radius:100%;position:relative}@media screen and (min-width: 40em){.me{width:7rem;height:7rem}}@media screen and (min-width: 54em){.me{width:6.5rem;height:6.5rem}}@media screen and (min-width: 72em){.me{width:7rem;height:7rem}}main>footer{width:100%;position:absolute;bottom:0;left:0;right:0;padding:0 1rem;color:#9a9a9a;font-size:smaller;text-align:center}main>footer>p{margin-bottom:0}html{font-family:'Sans-serif'}h1,h2,h3,h4,h5,h6,.h1,.h2,.h3,.h4,.h5,.h6,.heading{font-family:'Sans-serif'}

</style>


<link
  rel="preload"
  href="http://localhost:4000/assets/css/hydejack.css?v=6.4.0"
  as="style"
  onload="this.rel='stylesheet'"
/>

<style id="_pageStyle">

.content a{color:#4f86aa;border-color:rgba(79,134,170,0.2)}.content a:hover{border-color:#4f86aa}:focus{outline-color:#4f86aa}::selection{color:#fff;background:#4f86aa}::-moz-selection{color:#fff;background:#4f86aa}

</style>


<noscript>
  <link rel="stylesheet" href="http://localhost:4000/assets/css/hydejack.css?v=6.4.0" />
    
  
  <link
    rel="stylesheet"
    href="https://fonts.googleapis.com/css?family=Lato"
  />
  <style>
    html { font-family: 'Lato', 'Sans-serif' }
    h1, h2, h3, h4, h5, h6, .h1, .h2, .h3, .h4, .h5, .h6, .heading { font-family: 'Lato', 'Sans-serif' }
  </style>
   
  <link rel="stylesheet" href="http://localhost:4000/assets/icomoon/style.css" />
</noscript>
<!--<![endif]-->

</head>

<body>
  <!-- =============== -->
<!-- MENU            -->
<!-- =============== -->
<div class="navbar fixed-top">
  <div class="content">
    <span class="sr-only">Jump to:</span>
    <a id="_menu" class="menu no-hover" href="#_title">
      <span class="sr-only">Menu</span>
    </a>
  </div>
</div>

<!-- =============== -->
<!-- CONTENT         -->
<!-- =============== -->
<div id="_yPushState">
  <div class="fade-in">
    <main id="_main" class="content" role="main" data-color="#4f86aa" data-image="/assets/img/kumo.jpg">
      

<article id="post-ios/2019/09/20/iOS-AVFoundation-01" class="post" role="article">
  <header>
    <h1 class="post-title">
      
        iOS AVFoundation
        
    </h1>

    <p class="post-date heading">
      <time datetime="2019-09-20T00:00:00+09:00">20 Sep 2019</time>
      









in <a href="/category/ios/" data-flip="title">iOS</a>

      









on <a href="/tag/ios-avfoundation/" data-flip="title">AVFoundation</a>

    </p>

    
  <div class="hr" style="padding-bottom:0"></div>


  </header>
  


  
  <div class="markdown-body">

    <!--  -->
    <style>
      .myAd1190 {
        width: 48%;
        height: 280px;
      }

      .myAd1290 {
        width: 48%;
        height: 280px;
      }

      @media(max-width: 800px) {
        .myAd1190 {
          display: none;
        }

        .myAd1290 {
          width: 98%;
        }
      }

      .row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        height: 300px;
      }

      .row-center {
        display: flex;
        justify-content: center;
        height: 258px;
      }
    </style>
   
    <!--<br />-->
    <h1 id="avfoundation">AVFoundation</h1>

<p>AVFoundation은 애플의 미디어 프레임워크로 iOS,tvOS,macOS에서 사용된다. 시간 기반의 시청각 미디어 자료(동영상, mp3 오디오 파일 등)를 플레이하고 생성할 수 있는 프레임워크 중 하나이다. 이 프레임워크를 통해 미디어 파일을 조사하고 조작하는 것이 가능하다.</p>

<p><img width="745" alt="image" src="https://user-images.githubusercontent.com/33486820/65219721-19215100-daf4-11e9-866a-9ffa892b0b90.png" /></p>

<p>뿐만 아니라 HTTP Live Streaming을 통해 제공되는 원격 서버에 위치한 미디어 파일들까지 효과적으로 가져오고 제어할 수 있다.</p>

<h2 id="avasset-이란">AVAsset 이란?</h2>

<ul>
  <li>AVFoundation에서 미디어 자료를 표현하는 가장 대표적인 타입이다.</li>
  <li>AVAsset은 오디오와 비디오 트랙, 제목, 길이, 자연스러운 영상 사이즈 등 다양한 <strong>데이터 집합체</strong>이다.</li>
  <li>대부분의 미디어 파일 포맷을 지원 + HTTP Live Streaming(HLS)도 지원한다.</li>
</ul>

<h3 id="avasset의-미디어-제어">AVAsset의 미디어 제어</h3>

<p>AVAsset은 다음과 같이 두가지 방법으로 미디어 데이터를 다루는 것을 간소화 시켜준다.</p>

<ol>
  <li>
    <p>AVAsset은 포멧으로 부터 독립되어 일관된 인터페이스를 제공하며 코덱 타입과 같은 포멧에 종속적인 부분은 프레임워크가 알아서 처리해 주고 개발자는 미디어를 재생에 관련한 코드를 작성하는 것에만 집중할 수 있다.</p>
  </li>
  <li>
    <p>미디어 데이터의 위치(Location)에 상관 없이 URL을 통해 객체를 생성할 수 있다. 데이터가 local에 위치한다면 <code class="highlighter-rouge">Bundle</code>이나 파일 시스템의 URL을 통해 생성할 수 있고 리모트 저장소에 위치한다면 해당 URL을 통ㄹ해 생성할 수 있다.</p>
  </li>
</ol>

<h3 id="avasset의-트랙-접근">AVAsset의 트랙 접근</h3>

<p>AVAsset은 AVAssetTrack이라는 트랙 객체들로 이루어져 있다. 이런 트랙들의 구성은 하나의 미디어 데이터에 대한 오디오 트랙, 비디오 트랙, 자막 트랙 등 미디어 데이터를 이루는 여러 타입의 트랙들로 구성되어있다. 이러한 AVAsset에는 <code class="highlighter-rouge">tracks</code>라는 프로퍼티가 존재하므로 각 트랙에 접근이 가능하다.</p>

<p><img src="https://user-images.githubusercontent.com/33486820/65220008-c72cfb00-daf4-11e9-9251-3f443d714318.png" alt="image" /></p>

<blockquote>
  <p>AVAsset은 tracks 이라는 프로퍼티를 통해 3가지 트랙에 접근이 가능하다.</p>
</blockquote>

<h3 id="creating-an-asset">Creating an Asset</h3>

<p>AVAsset은 추상적인 클래스로 초기화 시에는 url을 사용해 AVAsset의 인스턴스가 아닌 AVURLAsset 타입의 인스턴스가 생성된다.</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="c1">// init method</span>
<span class="nf">init</span><span class="p">(</span><span class="n">url</span> <span class="kt">URL</span><span class="p">:</span> <span class="kt">URL</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span> <span class="p">:</span> <span class="kt">Any</span><span class="p">]?</span> <span class="o">=</span> <span class="kc">nil</span><span class="p">)</span>

<span class="c1">// URL을 통해 객체 생성</span>

<span class="k">let</span> <span class="nv">url</span> <span class="o">=</span> <span class="c1">// Remote 나 Local Asset의 URL </span>
<span class="k">let</span> <span class="nv">asset</span> <span class="o">=</span> <span class="kt">AVURLAsset</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span>  
</code></pre>
</div>

<h3 id="creaing-an-asset-with-options">Creaing an Asset with options</h3>

<p>위 처럼 단순하게 URL을 사용해서만 객체를 생성할 수도 있지만 options라는 매개변수를 통해 해당 객체를 보다 정교하게 생성할 수 있다. 이 매개변수는 <code class="highlighter-rouge">Key-Value</code>의 딕셔너리 타입으로 다음과 같이 사용할 수 있다.</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code>
<span class="k">let</span> <span class="nv">url</span><span class="p">:</span> <span class="kt">URL</span> <span class="o">=</span> <span class="c1">// Remote 나 Local Asset의 URL </span>
<span class="k">let</span> <span class="nv">options</span> <span class="o">=</span> <span class="p">[</span><span class="kt">AVURLAssetAllowsCellularAccessKey</span><span class="p">:</span> <span class="kc">false</span><span class="p">]</span>
<span class="k">let</span> <span class="nv">aseet</span> <span class="o">=</span> <span class="kt">AVURLAsset</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">url</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="n">options</span><span class="p">)</span>

</code></pre>
</div>

<ul>
  <li><code class="highlighter-rouge">AVURLAssetAllowCellualAccessKey</code> 속성은 와이파이가 아닌 셀룰러 데이터 환경에서 리모트 저장소에 있는 미디어 데이터를 사용할 것인지에 대한 옵션이다.</li>
</ul>

<h3 id="preparing-assets-for-use">Preparing Assets for Use</h3>

<p>AVAsset의 객체의 프로퍼티를 통해 현재 미디어 데이터의 재생 가능 여부, 총 재생시간, 생성 날짜 그리고 메타 데이터등의 데이터들에 접근이 가능하다.</p>

<blockquote>
  <p>주의할점</p>
</blockquote>

<p>AVAsset 객체를 생성했다고 위에서 언급한 정보들에 대해 즉시 접근할 수 있다는 걸 의미하는 것은 아니다. 이렇게 생성된 직후 아직 채워지지 않은 값을 받아오기 위한 상황에서 현재 스레드를 멈추어 동기적으로 해당 값이 채워질 때까지 기다려 값을 가져오는 것보단 <strong>Block에 정의한 Copletion handler를 통해 응답을 비동기 적으로 기다리는 방법이 더욱 적합하다.</strong></p>

<p><code class="highlighter-rouge">ladValuesAsynchronouslyForKeys: completionHandler:</code>를 통해 원하는 속성을 비동기적으로 받아올 수 있다.</p>

<ul>
  <li>현재 재생이 가능한지 여부에 대한 데이터를 담고있는 <code class="highlighter-rouge">playable</code> 속성을 가져오는 코드</li>
</ul>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">url</span> <span class="o">=</span> <span class="kt">Bundle</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="nf">url</span><span class="p">(</span><span class="nv">forResource</span><span class="p">:</span> <span class="s">"Ecstasy?"</span><span class="p">,</span> <span class="nv">withExtension</span><span class="p">:</span> <span class="s">"mp3"</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span>
        <span class="p">}</span>
        <span class="k">let</span> <span class="nv">asset</span> <span class="o">=</span> <span class="kt">AVAsset</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span>
        <span class="k">let</span> <span class="nv">playableKey</span> <span class="o">=</span> <span class="s">"playable"</span>
        
        <span class="n">asset</span><span class="o">.</span><span class="nf">loadValuesAsynchronously</span><span class="p">(</span><span class="nv">forKeys</span><span class="p">:</span> <span class="p">[</span><span class="n">playableKey</span><span class="p">])</span> <span class="p">{</span>
            <span class="k">var</span> <span class="nv">error</span><span class="p">:</span> <span class="kt">NSError</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span>
            <span class="k">let</span> <span class="nv">status</span> <span class="o">=</span> <span class="n">asset</span><span class="o">.</span><span class="nf">statusOfValue</span><span class="p">(</span><span class="nv">forKey</span><span class="p">:</span> <span class="n">playableKey</span><span class="p">,</span> <span class="nv">error</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">error</span><span class="p">)</span>
            <span class="k">switch</span> <span class="n">status</span> <span class="p">{</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">loaded</span><span class="p">:</span>
                <span class="c1">// 성공적으로 데이터를 받아 왔을때</span>
                <span class="k">break</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">failed</span><span class="p">:</span>
                <span class="c1">// 실패했을 경우</span>
                <span class="k">break</span>
            <span class="k">case</span> <span class="o">.</span><span class="nv">cancelled</span><span class="p">:</span>
                <span class="c1">// 도중에 취소된, 중단된 경우</span>
                <span class="k">break</span>
            <span class="k">default</span><span class="p">:</span>
                <span class="c1">// 기타 다른 경우</span>
                <span class="k">break</span>
                
            <span class="p">}</span>
        <span class="p">}</span>
</code></pre>
</div>

<h2 id="working-with-metadata">Working with Metadata</h2>

<p>포멧마다 메타데이터의 포멧 역시 다르기 떄문에 매우 까다롭다. AVFoundation은 이를 쉽게 다룰수 있는 <code class="highlighter-rouge">AVMetadataItem</code> 클래스를 제공한다.</p>

<p>메타데이터 데이터들은 Key-Value의 형태로 짝을 이루고 있고 이를 통해 비디오나 영화의 제목이나 앨범의 커버 사진등을 가져올 수 있다.(Thumbnail)</p>

<h2 id="retrieving-a-collection-metadata-metadata-모음-검색">Retrieving a Collection Metadata (Metadata 모음 검색)</h2>

<p><code class="highlighter-rouge">AVMetadataItem</code>을 효과적으로 사용하기 위해서는 AVFoundation이 메타데이터를 어떻게 구성하였는지를 이해해야한다. 메타데이터의 항목들을 쉽게찾고 필터링 하기 위해서는 AVFoundation은 관련된 메타데이터들을 <code class="highlighter-rouge">Key spaces</code> 로 묶어 관리한다.</p>

<ul>
  <li>
    <p>Format-specific key spaces: 포멧별 포멧에 한정된 메타데이터를 묶어 놓은 것<br />
하나의 <code class="highlighter-rouge">AVAsset</code>의 메타데이터는 여러 포멧 key spaces에 분포되어 존재할 수 있다. 이렇게 여러 key spaces에 분포되어있는 하나의 AVAsset의 메타데이터들 집합은 <code class="highlighter-rouge">metadata</code> 속성을 통해 접근이 가능하다.</p>
  </li>
  <li>
    <p>Common Key space: 포멧에 상관없이 공통으로 갖는 메타데이터들을 묶어 놓은 것<br />
영화 미디어 데이터라면 포멧에 상관없이 creation date와 description에 관한 메타데이터가 존재 할 것이다. 이들의 정보는 key spaces에 존재한다. <code class="highlighter-rouge">commonMetadata</code> 프로퍼티를 통해 접근이 가능하다.</p>
  </li>
</ul>

<p><code class="highlighter-rouge">availableMetadataFormats</code> 프로퍼티를 통해 AVAsset이 어떤 메타데이터의 포멧들을 갖고 있는지 알 수 있다.<br />
이 메소드는 문자열 형태의 포멧별 <strong>identifier</strong> 배열을 반환한다. 이와함께 <code class="highlighter-rouge">metadataFormat</code> 메소드를 이용하여 identifier에 해당하는 메타데이터의 포멧의 메타데이터를 가져 올 수 있다.</p>

<ul>
  <li>현재 재생이 가능한 metadata에서 데이터를 가져오는 코드</li>
</ul>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code>        <span class="k">guard</span> <span class="k">let</span> <span class="nv">url</span> <span class="o">=</span> <span class="kt">Bundle</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="nf">url</span><span class="p">(</span><span class="nv">forResource</span><span class="p">:</span> <span class="s">"Ecstasy?"</span><span class="p">,</span> <span class="nv">withExtension</span><span class="p">:</span> <span class="s">"mp3"</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span>
        <span class="p">}</span>
        <span class="k">let</span> <span class="nv">asset</span> <span class="o">=</span> <span class="kt">AVAsset</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span>
        <span class="k">let</span> <span class="nv">formatsKey</span> <span class="o">=</span> <span class="s">"availableMetadataFormats"</span>
        
        <span class="n">asset</span><span class="o">.</span><span class="nf">loadValuesAsynchronously</span><span class="p">(</span><span class="nv">forKeys</span><span class="p">:</span> <span class="p">[</span><span class="n">formatsKey</span><span class="p">])</span> <span class="p">{</span>
            <span class="k">var</span> <span class="nv">error</span><span class="p">:</span> <span class="kt">NSError</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span>
            <span class="k">let</span> <span class="nv">status</span> <span class="o">=</span> <span class="n">asset</span><span class="o">.</span><span class="nf">statusOfValue</span><span class="p">(</span><span class="nv">forKey</span><span class="p">:</span> <span class="n">formatsKey</span><span class="p">,</span> <span class="nv">error</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">error</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="o">.</span><span class="n">loaded</span> <span class="p">{</span>
                <span class="c1">// identifier를 배열 행태로 반환 하기 떄문에 for문을 통해 하나씩 metadata에 하나씩 접근해야한다.</span>
                <span class="k">for</span> <span class="n">format</span> <span class="k">in</span> <span class="n">asset</span><span class="o">.</span><span class="n">availableMetadataFormats</span> <span class="p">{</span>
                    <span class="k">let</span> <span class="nv">metadata</span> <span class="o">=</span> <span class="n">asset</span><span class="o">.</span><span class="nf">metadata</span><span class="p">(</span><span class="nv">forFormat</span><span class="p">:</span> <span class="n">format</span><span class="p">)</span>
                    
                <span class="p">}</span>
            <span class="p">}</span>
</code></pre>
</div>

<h2 id="finding-and-using-metadata-values">Finding and Using Metadata Values</h2>

<p>metadata collection에서 <code class="highlighter-rouge">AVMetadataItem</code>과 <code class="highlighter-rouge">identifier</code>를 통해 원하는 특정 메타데이터를 가져올 수 있다.</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code>
	<span class="k">let</span> <span class="nv">metadata</span> <span class="o">=</span> <span class="n">asset</span><span class="o">.</span><span class="n">commonMetadata</span>
    <span class="k">let</span> <span class="nv">titleID</span> <span class="o">=</span> <span class="kt">AVmetdataCommonIdentifierTitle</span>
    <span class="k">let</span> <span class="nv">titleItems</span> <span class="o">=</span> <span class="kt">AVMetdataItem</span><span class="o">.</span><span class="nf">metadataItems</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="n">metadata</span><span class="p">,</span> <span class="nv">filteredByIdentifier</span><span class="p">:</span> <span class="n">titleID</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="k">let</span> <span class="nv">item</span> <span class="o">=</span> <span class="n">titleItems</span><span class="o">.</span><span class="n">first</span> <span class="p">{</span>
    	<span class="c1">// title item 배열의 첫번째 항목</span>
    <span class="p">}</span>
</code></pre>
</div>

<blockquote>
  <p>AVMetdataItem 메소드는 메타데이터의 값을 컬렉션 형태로 반환한다. 이 컬렉션에 대부분 하나의 요소만 담겨있다. 하지만 미디어 데이터가 Localized 메타데이터나 CommonKeyspace에 분포되어 있는 메타데이터 혹은 여러 Keyspace에 존재하는 메타데이터를 가져오려 한다면 각각의 Local과 Keyspace에 맞는 값들을 모두 반환해 준다.</p>
</blockquote>

<p>metadataItem을 가져온 후 <code class="highlighter-rouge">value</code> 프로퍼티를 통해 해당 메타데이터의 실제 값에 접근 할 수 있다. 이렇게 반환되는 값은 <code class="highlighter-rouge">NSObject</code>를 상속받고 <code class="highlighter-rouge">NSCopying</code> 프로토콜을 따르고 있다. 그리고 이를 <code class="highlighter-rouge">.stringValue</code>, <code class="highlighter-rouge">.numberValue</code>, <code class="highlighter-rouge">.dateValue</code>, <code class="highlighter-rouge">.dataValue</code>등ㅇ의 프로퍼티를 이용해 원하는 타입으로 받아와 사용하면된다.</p>

<ul>
  <li>iTunes music track의 앨범 커버를 가져오는 코드</li>
</ul>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code>      <span class="c1">// common metadata의 모음</span>
      <span class="k">let</span> <span class="nv">metadata</span> <span class="o">=</span> <span class="n">asset</span><span class="o">.</span><span class="n">commonMetadata</span>
      <span class="c1">// 메타데이터 모음에서 해당하는 identifier의 metadata의 item을 가져온다.</span>
      <span class="k">let</span> <span class="nv">artworkItems</span> <span class="o">=</span> <span class="kt">AVMetadataItem</span><span class="o">.</span><span class="nf">metadataItems</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="n">metadata</span><span class="p">,</span>
      							<span class="nv">filteredByIdentifier</span><span class="p">:</span> <span class="n">commonIdentifierArtwork</span><span class="p">)</span>
      <span class="k">if</span> <span class="k">let</span> <span class="nv">artworkItem</span> <span class="o">=</span> <span class="n">artworkItems</span><span class="o">.</span><span class="n">first</span> <span class="p">{</span>
          <span class="c1">// dataValue 프로퍼티를 사용 하여 값을 NSData로 강제 변환</span>
          <span class="k">if</span> <span class="k">let</span> <span class="nv">imageData</span> <span class="o">=</span> <span class="n">artworkItem</span><span class="o">.</span><span class="n">dataValue</span> <span class="p">{</span>
              <span class="k">let</span> <span class="nv">image</span> <span class="o">=</span> <span class="kt">UIImage</span><span class="p">(</span><span class="nv">data</span><span class="p">:</span> <span class="n">imageData</span><span class="p">)</span>
              <span class="c1">// process image</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
              <span class="c1">// No image data found</span>
          <span class="p">}</span>
      <span class="p">}</span>
</code></pre>
</div>

<p><br /></p>

<h2 id="playing-media">Playing Media</h2>

<blockquote>
  <p>Playback의 의미를 일종의 재생과 관련된 행위들이라고 이해하는 것이 편하다. 재생과 관련된 행위들이란 단순하게 시간 순서대로 재생하는 것 뿐만 아니라 녹음,녹화등의 행위도 포함되어있다.</p>
</blockquote>

<ul>
  <li><code class="highlighter-rouge">AVPlayer</code> : Asset의 전반적인 playback을 조적하는데 사용</li>
  <li><code class="highlighter-rouge">AVPlayerItem</code> : Asset의 Presentation state(현재 상태)를 관리하는데 사용</li>
  <li><code class="highlighter-rouge">AVPlayerItemTrack</code> : Asset안 각각의 track의 Presentation state를 관리하는데 사용</li>
  <li>
    <p><code class="highlighter-rouge">AVPlayerLayer</code> : 영상을 출력하기 위해 사용</p>
  </li>
  <li>미디어 데이터의 재생에 관련된 객체들의 관계도</li>
</ul>

<p><img width="745" alt="image" src="https://user-images.githubusercontent.com/33486820/65246902-67514700-db2a-11e9-99ca-dcc3aab8205e.png" /></p>

<h3 id="avplayer">AVPlayer</h3>

<p><code class="highlighter-rouge">AVPlayer</code>객체는 미디어 데이터 재생에 핵심 클래스이다. 재생과 정지 그리고 특정 시간대로 이동하는 등의 재생에 전반적인 것을 관리힌다.</p>

<blockquote>
  <p>AVPlayer는 한번에 하나의 미디어 데이터만 재생할 수 있다. AVFoundation은 여러 미디어 데이터를 순서대로 재생하는 AVQueuePlayer 클래스도 제공한다.</p>
</blockquote>

<p>AVPlayerItem</p>

<p>또한 AVPlayer는 현재 재생 중인 미디어 데이터에 대한 상태 정보를 제공하므로 이를 바탕으로 해당 정보에 맞추어 UI를 동기화 작업도 가능합니다. 이런 동기화 작업의 대표적인 예는 바로 player 의 출력물을 AVPlayerLayer 혹은 AVSynchronizedLayer 와 같은 Core Animation Layer를 통해 보여주는 작업이 있다.</p>

<h3 id="avasset-vs-avplayeritem">AVAsset vs AVPlayerItem</h3>

<ul>
  <li>AVAsset : 총 재생 시간, 생성 날짜 등의 <strong>정적(Static)</strong> 한 영역만 모델링 하기 때문에 실질적인 미디어 데이터 재생에는 적합 하지 않다.</li>
  <li>AVPlayerItem: 할당된 미디어 데이터에 대한 Presentation state를 관리한다. 이를 활용하여 재생 중인 미디어 데이터의 현재 시간을 가져오거나 하는 <strong>동적</strong>인 데이터들을 사용할 수 있다.</li>
</ul>

<p>또한 <code class="highlighter-rouge">AVPlayerItem</code> 안에는 <code class="highlighter-rouge">AVPlayerItemTrack</code> 객체들도 존재하는데 이들은 <code class="highlighter-rouge">AVPlayerItem</code> 객체가 갖고 있는 asset의 track들을 관리한다.</p>

<p><img width="745" alt="image" src="https://user-images.githubusercontent.com/33486820/65248081-8f41aa00-db2c-11e9-9443-43743cdc8d27.png" /></p>

<p>다음 그림은 동일한 asset을 다른 AVPlayer 객체가 동시에 재생하고 있지만 서로 다른 랜더링 방법을 통해 서로 다른 결과물을 출력할 수 있다는 것을 묘사하고 있다.</p>

<p>위에서 언급한 <code class="highlighter-rouge">AVPlayerItem</code> 안의 <code class="highlighter-rouge">AVPlayerItemTrack</code> 객체를 이용해 같은 asset이지만 track들을 조정해 밑의 예제와 같이 영상 미디어 데이터에서 video 트랙만 활성화시키고 audio 트랙은 비활성화시키는 등의 편집이 가능하다.</p>

<p><img width="745" alt="image" src="https://user-images.githubusercontent.com/33486820/65248242-d5970900-db2c-11e9-8aba-13272e6b0f79.png" /></p>

<p>이런 <code class="highlighter-rouge">AVPlayerItem</code> 객체는 로컬에 존재하는 미디어 데이터를 이용하여 생성할 수도 있지만 서버와 같이 다른 곳에 위치하는 미디어 데이터 역시 URL을 통해 생성할 수 있다.</p>

<p><code class="highlighter-rouge">AVAsset</code>과 마찬가지로 <code class="highlighter-rouge">AVPlayerItem</code> 객체를 생성했다고 그 즉시 바로 사용할 수 있는 것은 아니다. 항상 생성한 후 객체의 <strong>status 프로퍼티를 활용해서 현재 사용할 준비가 되었는지를 확인</strong>해주어야 한다.</p>

<h2 id="avkit-and-avplayerlayer">AVKit and AVPlayerLayer</h2>

<p><code class="highlighter-rouge">AVPlayer</code> 와 <code class="highlighter-rouge">AVPlayerItem</code> 은 <strong>비시각적인 객체</strong>로 그들 스스로 화면에 영상을 출력하지 못한다. 그렇기 때문에 이들을 화면에 출력시킬 수 있는 두가지 옵션이 있다..</p>

<ul>
  <li>
    <p><code class="highlighter-rouge">AVKit</code> : 가장 좋은 방법은 AVKit 프레임워크를 활용하는 건데 iOS나 tvOS에선 AVPlayerViewController 를 macOS에선 AVPlayerView 를 사용하는 것 이다. 이 객체들은 비디오 컨텐츠를 보여주고 재생에 관련된 모든 기능들이 완벽하게 구현되어 제공된다.</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">AVPlayerLayer</code>: 비디오 컨텐츠를 재생하는 플레이어를 커스터마이징 하여 여러 기능들을 직접 추가하여 만들고 싶다면 AVFoundation에서 제공하고 Core Animation의 CALayer 를 상속받은 AVPlayerLayer를 사용하면 된다. 이는 재생에 관련된 어떠한 기능도 제공되지 않고 오직 화면 출력 기능만을 제공하기 때문에 미디어 재생에 관한 기능들은 직접 모두 구현해주어야 한다.</p>
  </li>
</ul>

<h2 id="setting-up-the-playback-objects">Setting Up the Playback Objects</h2>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code>      <span class="kd">class</span> <span class="kt">PlayerViewController</span><span class="p">:</span> <span class="kt">UIViewController</span> <span class="p">{</span>

          <span class="kd">@IBOutlet</span> <span class="k">weak</span> <span class="k">var</span> <span class="nv">playerViewController</span><span class="p">:</span> <span class="kt">AVPlayerViewController</span><span class="o">!</span>

          <span class="k">var</span> <span class="nv">player</span><span class="p">:</span> <span class="kt">AVPlayer</span><span class="o">!</span>
          <span class="k">var</span> <span class="nv">playerItem</span><span class="p">:</span> <span class="kt">AVPlayerItem</span><span class="o">!</span>

          <span class="k">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
              <span class="k">super</span><span class="o">.</span><span class="nf">viewDidLoad</span><span class="p">()</span>

              <span class="c1">// 1) URL 주소 정의</span>
              <span class="k">let</span> <span class="nv">url</span><span class="p">:</span> <span class="kt">URL</span> <span class="o">=</span> <span class="c1">// URL to local or streamed media</span>

              <span class="c1">// 2) Asset 객체 생성</span>
              <span class="k">let</span> <span class="nv">asset</span> <span class="o">=</span> <span class="kt">AVAsset</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span>

              <span class="c1">// 3) 해당 Asset으로 Player Item 생성 -&gt; 동적인 데이터 사용하기 위해 AVPlayerItem 사용</span>
              <span class="n">playerItem</span> <span class="o">=</span> <span class="kt">AVPlayerItem</span><span class="p">(</span><span class="nv">asset</span><span class="p">:</span> <span class="n">asset</span><span class="p">)</span>

              <span class="c1">// 4) Player 객체 생성</span>
              <span class="n">player</span> <span class="o">=</span> <span class="kt">AVPlayer</span><span class="p">(</span><span class="nv">playerItem</span><span class="p">:</span> <span class="n">playerItem</span><span class="p">)</span>

              <span class="c1">// 5) Associate player with view controller</span>
              <span class="n">playerViewController</span><span class="o">.</span><span class="n">player</span> <span class="o">=</span> <span class="n">player</span>
          <span class="p">}</span>
      <span class="p">}</span>
</code></pre>
</div>

<p>객체가 생성되면 <code class="highlighter-rouge">AVplayer</code> 의 <code class="highlighter-rouge">play</code> 메소드를 통해 재생을 시작할 수 있다. <code class="highlighter-rouge">AVPlayer</code> 와 <code class="highlighter-rouge">AVPlayerItem</code> 은 재생할 미디어 데이터가 준비되었을 때 재생을 시작하는 많은 방법들들을 제공한다.</p>

<h2 id="observing-playback-state">Observing Playback State</h2>

<p><code class="highlighter-rouge">AVPlayer</code>와 <code class="highlighter-rouge">AVPlayerItem</code>은 그 상태가 지속해서 변하는 <strong>동적인 객체</strong>이다. 이러한 상태에 따른 액션을 정의해주기 위해서는 <strong>KVO 기법</strong>(<a href="https://github.com/gaki2745/Youngjun-iOS-Studio/tree/master/KeyValueObserving">gaki iOS-Studio : KVO</a>을 사용한다.<br />
KVO 기법은 한 객체로 하여금 다른 객체의 상태를 관찰하는 행위를 가능하게 한다. 이러한 KVO 기법을 사용한다면 AVPlayer와 AVPlayerItem의 상태 변화를 감지하고 이에 대응하는 행위를 쉽게 정의할 수 있다.</p>

<p><code class="highlighter-rouge">AVPlayerItem</code> 의 프로퍼티 중 변화를 감지해야 하는 중요한 프로퍼티는 바로 <code class="highlighter-rouge">status</code>이다. status는 현재 플레이어의 미디어 데이터가 재생할 준비가 되어있는지를 판단할 때 사용한다. <code class="highlighter-rouge">AVPlayerItem</code>을 생성한 직후에는 이 status 프로퍼티의 값은 <code class="highlighter-rouge">AVPlayerItemStatusUnknown</code> 으로 재상할 미디어 데이터를 아직 온전히 불러오지 못하였다는 뜻이고 재생할 준비가 되어있지 않다는 의미이다. 재생할 준비가 다 되면 status의 값은 <code class="highlighter-rouge">AVPlayerItemStatusReadyToPlay</code>로 변경됩니다.</p>

<ul>
  <li><code class="highlighter-rouge">AVPlayerItemStatusUnknown</code> or <code class="highlighter-rouge">AVPlayerItemStatusReadyToPlay</code>로 변경을 감지하는 코드</li>
</ul>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code>      <span class="k">let</span> <span class="nv">url</span><span class="p">:</span> <span class="kt">URL</span> <span class="o">=</span> <span class="c1">// Asset URL</span>
      <span class="k">var</span> <span class="nv">asset</span><span class="p">:</span> <span class="kt">AVAsset</span><span class="o">!</span>
      <span class="k">var</span> <span class="nv">player</span><span class="p">:</span> <span class="kt">AVPlayer</span><span class="o">!</span>
      <span class="k">var</span> <span class="nv">playerItem</span><span class="p">:</span> <span class="kt">AVPlayerItem</span><span class="o">!</span>
      <span class="kd">private</span> <span class="k">var</span> <span class="nv">playerItemContext</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1">// Key-value observing context</span>
      <span class="k">let</span> <span class="nv">requiredAssetKeys</span> <span class="o">=</span> <span class="p">[</span><span class="s">"playable"</span><span class="p">,</span> <span class="s">"hasProtectedContent"</span><span class="p">]</span>

      <span class="kd">func</span> <span class="nf">prepareToPlay</span><span class="p">()</span> <span class="p">{</span>
          <span class="c1">// Create the asset to play</span>
          <span class="n">asset</span> <span class="o">=</span> <span class="kt">AVAsset</span><span class="p">(</span><span class="nv">url</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span>

          <span class="c1">// Create a new AVPlayerItem with the asset and an</span>
          <span class="c1">// array of asset keys to be automatically loaded</span>
          <span class="n">playerItem</span> <span class="o">=</span> <span class="kt">AVPlayerItem</span><span class="p">(</span><span class="nv">asset</span><span class="p">:</span> <span class="n">asset</span><span class="p">,</span> <span class="nv">automaticallyLoadedAssetKeys</span><span class="p">:</span> <span class="n">requiredAssetKeys</span><span class="p">)</span>

          <span class="c1">// player item status의 변화를 감지</span>
          <span class="n">playerItem</span><span class="o">.</span><span class="nf">addObserver</span><span class="p">(</span><span class="k">self</span><span class="p">,</span>
                                 <span class="nv">forKeyPath</span><span class="p">:</span> <span class="err">#</span><span class="nf">keyPath</span><span class="p">(</span><span class="kt">AVPlayerItem</span><span class="o">.</span><span class="n">status</span><span class="p">),</span>
                                 <span class="nv">options</span><span class="p">:</span> <span class="p">[</span><span class="o">.</span><span class="n">old</span><span class="p">,</span> <span class="o">.</span><span class="k">new</span><span class="p">],</span>
                                 <span class="nv">context</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">playerItemContext</span><span class="p">)</span>

          <span class="c1">// Associate the player item with the player</span>
          <span class="n">player</span> <span class="o">=</span> <span class="kt">AVPlayer</span><span class="p">(</span><span class="nv">playerItem</span><span class="p">:</span> <span class="n">playerItem</span><span class="p">)</span>
      <span class="p">}</span>
</code></pre>
</div>
<p><br /></p>

<p><code class="highlighter-rouge">prepareToPlay</code> 메소드는 status 프로퍼티 값의 변화를 감지하기 위해 <code class="highlighter-rouge">addObserver(_:forKeyPath:,options:,context:)</code> 메소드를 사용해 Observer를 <code class="highlighter-rouge">AVPlayerItem</code> 객체에 등록한다. 이런 <strong>Observer를 등록하는 행위는 AVPlayerItem 과 AVPlayer 를 연결시키기 전에 이루어져야 한다</strong>.</p>

<p><br /></p>

<p>그리고 status 값의 변화를 전달 받기 위해서는 <code class="highlighter-rouge">observeValueForKeyPath(forKeyPath:, of:, change:, context:)</code> 메소드를 구현해야한다. 이 메소드는 status가 변하면 언제든지 호출되기 때문에 이 메소드 안에 값의 변화에 대응하는 액션을 정의해주면 된다.(callback 함수)</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code>      <span class="k">override</span> <span class="kd">func</span> <span class="nf">observeValue</span><span class="p">(</span><span class="n">forKeyPath</span> <span class="nv">keyPath</span><span class="p">:</span> <span class="kt">String</span><span class="p">?,</span>
                                 <span class="n">of</span> <span class="nv">object</span><span class="p">:</span> <span class="kt">Any</span><span class="p">?,</span>
                                 <span class="nv">change</span><span class="p">:</span> <span class="p">[</span><span class="kt">NSKeyValueChangeKey</span> <span class="p">:</span> <span class="kt">Any</span><span class="p">]?,</span>
                                 <span class="nv">context</span><span class="p">:</span> <span class="kt">UnsafeMutableRawPointer</span><span class="p">?)</span> <span class="p">{</span>

          <span class="c1">// Only handle observations for the playerItemContext</span>
          <span class="k">guard</span> <span class="n">context</span> <span class="o">==</span> <span class="o">&amp;</span><span class="n">playerItemContext</span> <span class="k">else</span> <span class="p">{</span>
              <span class="k">super</span><span class="o">.</span><span class="nf">observeValue</span><span class="p">(</span><span class="nv">forKeyPath</span><span class="p">:</span> <span class="n">keyPath</span><span class="p">,</span>
                                 <span class="nv">of</span><span class="p">:</span> <span class="n">object</span><span class="p">,</span>
                                 <span class="nv">change</span><span class="p">:</span> <span class="n">change</span><span class="p">,</span>
                                 <span class="nv">context</span><span class="p">:</span> <span class="n">context</span><span class="p">)</span>
              <span class="k">return</span>
          <span class="p">}</span>

          <span class="k">if</span> <span class="n">keyPath</span> <span class="o">==</span> <span class="err">#</span><span class="nf">keyPath</span><span class="p">(</span><span class="kt">AVPlayerItem</span><span class="o">.</span><span class="n">status</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">let</span> <span class="nv">status</span><span class="p">:</span> <span class="kt">AVPlayerItemStatus</span>
              <span class="k">if</span> <span class="k">let</span> <span class="nv">statusNumber</span> <span class="o">=</span> <span class="n">change</span><span class="p">?[</span><span class="o">.</span><span class="n">newKey</span><span class="p">]</span> <span class="k">as?</span> <span class="kt">NSNumber</span> <span class="p">{</span>
                  <span class="n">status</span> <span class="o">=</span> <span class="kt">AVPlayerItemStatus</span><span class="p">(</span><span class="nv">rawValue</span><span class="p">:</span> <span class="n">statusNumber</span><span class="o">.</span><span class="n">intValue</span><span class="p">)</span><span class="o">!</span>
              <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                  <span class="n">status</span> <span class="o">=</span> <span class="o">.</span><span class="n">unknown</span>
              <span class="p">}</span>
              <span class="c1">// Switch over status value</span>
              <span class="k">switch</span> <span class="n">status</span> <span class="p">{</span>
              <span class="k">case</span> <span class="o">.</span><span class="nv">readyToPlay</span><span class="p">:</span>
                  <span class="c1">// Player item is ready to play.</span>
              <span class="k">case</span> <span class="o">.</span><span class="nv">failed</span><span class="p">:</span>
                  <span class="c1">// Player item failed. See error.</span>
              <span class="k">case</span> <span class="o">.</span><span class="nv">unknown</span><span class="p">:</span>
                  <span class="c1">// Player item is not yet ready.</span>
              <span class="p">}</span>
          <span class="p">}</span>
      <span class="p">}</span>
</code></pre>
</div>

<h2 id="performing-time-based-operations">Performing Time-Based Operations</h2>

<p>미디어 재생은 시간에 기반한 작업으로 <code class="highlighter-rouge">AVPlayer</code>와 <code class="highlighter-rouge">AVPlayerItem</code> 의 주요 기능과 특징들은 이러한 미디어의 시간대를 조절하는 것과 연관되어 있다. 이러한 기능들을 효과적으로 사용하기 위해서는 시간이라는 것이 <code class="highlighter-rouge">AVFoundation</code>에서 어떻게 표현되고 있는지를 이해해야 한다.</p>

<p><br /></p>

<p><code class="highlighter-rouge">AVFoundation</code>의 일부를 포함한 애플의 프레임워크에서 시간은 부동소수점의 <code class="highlighter-rouge">NSTimeInterval</code> 값으로 표현되며 이는 초를 나타낸다. <code class="highlighter-rouge">NSTimeInterval</code>로 표현된 시간들은 대부분 용도에 맞게 자연스레 사용이 되지만 부동소수점의 부정확성으로 인해 디테일한 시간의 작업이 필요한 미디어 재생에서는 문제점을 발생시킵니다.</p>

<p>이러한 부동소수점의 부정확성을 해결하고자 AVFoundation은 시간을 Core Media 프레임워크의 <code class="highlighter-rouge">CMTime</code> 타입을 이용해 표현한다.<br />
<br /></p>

<p>Core Media는 low-level의 C 프레임워크다. 대부분의 기능을 AVFoundation 같이 애플의 High-level 프레임워크의 인터페이스를 통해 사용한다. 하지만 CMTime은 Core Media를 통해 직접적으로 다룰 수 있는 구조체 데이터 타입이다.</p>

<p><br /></p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">struct</span> <span class="kt">CMTime</span> <span class="p">{</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">value</span><span class="p">:</span> <span class="kt">CMTimeValue</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">timescale</span><span class="p">:</span> <span class="kt">CMTimeScale</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">flags</span><span class="p">:</span> <span class="kt">CMTimeFlags</span>
    <span class="kd">public</span> <span class="k">var</span> <span class="nv">epoch</span><span class="p">:</span> <span class="kt">CMTimeEpoch</span>
<span class="p">}</span>
</code></pre>
</div>

<p>이 구조체는 유리수나 분수의 형태로 시간을 표현한다. CMTime 구조체의 속성 중 가장 중요한 속성들은 <code class="highlighter-rouge">value</code>와 <code class="highlighter-rouge">timescale</code> 속성이다.</p>

<p><br /></p>

<ul>
  <li>CMTimeValue : 64 비트 정수로 분수로 표현되는 시간의 분자 값을 정의</li>
  <li>CMTimeScale : 32비트 정수로 분모 값을 정의</li>
</ul>

<blockquote>
  <p>CMTime 을 활용하여 미디어 재생에 사용되는 시간을 보다 쉽게 구현할 수 있다.</p>
</blockquote>

<p><br /></p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code>      <span class="c1">// 0.25 seconds</span>
      <span class="k">let</span> <span class="nv">quarterSecond</span> <span class="o">=</span> <span class="kt">CMTime</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="nv">timescale</span><span class="p">:</span> <span class="mi">4</span><span class="p">)</span>

      <span class="c1">// 10 second mark in a 44.1 kHz audio file</span>
      <span class="k">let</span> <span class="nv">tenSeconds</span> <span class="o">=</span> <span class="kt">CMTime</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="mi">441000</span><span class="p">,</span> <span class="nv">timescale</span><span class="p">:</span> <span class="mi">44100</span><span class="p">)</span>

      <span class="c1">// 3 seconds into a 30fps video</span>
      <span class="k">let</span> <span class="nv">cursor</span> <span class="o">=</span> <span class="kt">CMTime</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="mi">90</span><span class="p">,</span> <span class="nv">timescale</span><span class="p">:</span> <span class="mi">30</span><span class="p">)</span>
</code></pre>
</div>

<p><br /></p>

<h2 id="observing-time-미디어-재생-시간-변화-관찰">Observing Time (미디어 재생 시간 변화 관찰)</h2>

<p>대게 미디어의 현재 재생 시간을 관찰하는 행위는 미디어가 재생됨에 따라 UISlider를 갱신시켜주는 등의 UI를 갱신을 목적으로 한다. 이러한 지속적인 변화를 관찰하는 행위를 KVO 기법으로 하는 것은 부적합하다. AVPlayer는 미디어 재생의 시간 변화를 관찰하는 방법 두 가지를 제공하는데 그것이 바로 <code class="highlighter-rouge">Periodic Observation</code>과 <code class="highlighter-rouge">Boundary Observation</code>이다.</p>

<p><br /></p>

<h2 id="periodic-observation">Periodic Observation</h2>

<p><code class="highlighter-rouge">addPeriodicTimeObserver(forInterval:queue:using:)</code> 메소드를 이용하면 일정한 주기의 시간 변화를 관찰할 수 있으며 이는 미디어의 재생 시간이 진행되는 것을 보여주는 UI를 갱신하는데 주로 사용한다. 이 메소드는 일정한 주기의 시간을 나타내는데 CMTime을 사용하고 해당 주기마다 실행되어야 하는 액션들을 Block 안에 정의해준다.</p>

<p><br /></p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code>      <span class="k">var</span> <span class="nv">player</span><span class="p">:</span> <span class="kt">AVPlayer</span><span class="o">!</span>
      <span class="k">var</span> <span class="nv">playerItem</span><span class="p">:</span> <span class="kt">AVPlayerItem</span><span class="o">!</span>
      <span class="k">var</span> <span class="nv">timeObserverToken</span><span class="p">:</span> <span class="kt">Any</span><span class="p">?</span>

      <span class="kd">func</span> <span class="nf">addPeriodicTimeObserver</span><span class="p">()</span> <span class="p">{</span>
          <span class="c1">// Notify every half second</span>
          <span class="k">let</span> <span class="nv">timeScale</span> <span class="o">=</span> <span class="kt">CMTimeScale</span><span class="p">(</span><span class="kt">NSEC_PER_SEC</span><span class="p">)</span>
          <span class="k">let</span> <span class="nv">time</span> <span class="o">=</span> <span class="kt">CMTime</span><span class="p">(</span><span class="nv">seconds</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="nv">preferredTimescale</span><span class="p">:</span> <span class="n">timeScale</span><span class="p">)</span>
          <span class="n">timeObserverToken</span> <span class="o">=</span> <span class="n">player</span><span class="o">.</span><span class="nf">addPeriodicTimeObserver</span><span class="p">(</span><span class="nv">forInterval</span><span class="p">:</span> <span class="n">time</span><span class="p">,</span>
                                                             <span class="nv">queue</span><span class="p">:</span> <span class="o">.</span><span class="n">main</span><span class="p">)</span> <span class="p">{</span>
              <span class="p">[</span><span class="k">weak</span> <span class="k">self</span><span class="p">]</span> <span class="n">time</span> <span class="k">in</span>
              <span class="c1">// update player transport UI</span>
          <span class="p">}</span>
      <span class="p">}</span>

      <span class="kd">func</span> <span class="nf">removePeriodicTimeObserver</span><span class="p">()</span> <span class="p">{</span>
          <span class="k">if</span> <span class="k">let</span> <span class="nv">timeObserverToken</span> <span class="o">=</span> <span class="n">timeObserverToken</span> <span class="p">{</span>
              <span class="n">player</span><span class="o">.</span><span class="nf">removeTimeObserver</span><span class="p">(</span><span class="n">timeObserverToken</span><span class="p">)</span>
              <span class="k">self</span><span class="o">.</span><span class="n">timeObserverToken</span> <span class="o">=</span> <span class="kc">nil</span>
          <span class="p">}</span>
      <span class="p">}</span>
</code></pre>
</div>

<p><br /></p>

<h2 id="boudary-observations">Boudary Observations</h2>

<p>시간을 관찰하는 다음 방법은 <code class="highlighter-rouge">addBoundaryTimeObserver(forTimes:queue:using:)</code> 메소드를 사용하는 것이다. 이 방법은 미디어의 전체 재생 타임라인 중에 원하는 시간대에 일어났으면 하는 행위들을 정의할 때 사용한다. 이 메소드는 액션이 발생하기를 원하는 시간대를 배열의 형태로 받고 원하는 액션을 Block안에 정의해준다.</p>

<p><br /></p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code>      <span class="k">var</span> <span class="nv">asset</span><span class="p">:</span> <span class="kt">AVAsset</span><span class="o">!</span>
      <span class="k">var</span> <span class="nv">player</span><span class="p">:</span> <span class="kt">AVPlayer</span><span class="o">!</span>
      <span class="k">var</span> <span class="nv">playerItem</span><span class="p">:</span> <span class="kt">AVPlayerItem</span><span class="o">!</span>
      <span class="k">var</span> <span class="nv">timeObserverToken</span><span class="p">:</span> <span class="kt">Any</span><span class="p">?</span>

      <span class="kd">func</span> <span class="nf">addBoundaryTimeObserver</span><span class="p">()</span> <span class="p">{</span>

          <span class="c1">// Divide the asset's duration into quarters.</span>
          <span class="k">let</span> <span class="nv">interval</span> <span class="o">=</span> <span class="kt">CMTimeMultiplyByFloat64</span><span class="p">(</span><span class="n">asset</span><span class="o">.</span><span class="n">duration</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">)</span>
          <span class="k">var</span> <span class="nv">currentTime</span> <span class="o">=</span> <span class="n">kCMTimeZero</span>
          <span class="k">var</span> <span class="nv">times</span> <span class="o">=</span> <span class="p">[</span><span class="kt">NSValue</span><span class="p">]()</span>

          <span class="c1">// Calculate boundary times</span>
          <span class="k">while</span> <span class="n">currentTime</span> <span class="o">&lt;</span> <span class="n">asset</span><span class="o">.</span><span class="n">duration</span> <span class="p">{</span>
              <span class="n">currentTime</span> <span class="o">=</span> <span class="n">currentTime</span> <span class="o">+</span> <span class="n">interval</span>
              <span class="n">times</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="kt">NSValue</span><span class="p">(</span><span class="nv">time</span><span class="p">:</span><span class="n">currentTime</span><span class="p">))</span>
          <span class="p">}</span>

          <span class="n">timeObserverToken</span> <span class="o">=</span> <span class="n">player</span><span class="o">.</span><span class="nf">addBoundaryTimeObserver</span><span class="p">(</span><span class="nv">forTimes</span><span class="p">:</span> <span class="n">times</span><span class="p">,</span>
                                                             <span class="nv">queue</span><span class="p">:</span> <span class="o">.</span><span class="n">main</span><span class="p">)</span> <span class="p">{</span>
              <span class="c1">// Update UI</span>
          <span class="p">}</span>
      <span class="p">}</span>

      <span class="kd">func</span> <span class="nf">removeBoundaryTimeObserver</span><span class="p">()</span> <span class="p">{</span>
          <span class="k">if</span> <span class="k">let</span> <span class="nv">timeObserverToken</span> <span class="o">=</span> <span class="n">timeObserverToken</span> <span class="p">{</span>
              <span class="n">player</span><span class="o">.</span><span class="nf">removeTimeObserver</span><span class="p">(</span><span class="n">timeObserverToken</span><span class="p">)</span>
              <span class="k">self</span><span class="o">.</span><span class="n">timeObserverToken</span> <span class="o">=</span> <span class="kc">nil</span>
          <span class="p">}</span>
      <span class="p">}</span>
</code></pre>
</div>

<p><br /></p>

<h2 id="seeking-media">Seeking Media</h2>

<p>재생을 통해 미디어를 시간 순서에 따라 시청하고 듣는 것 이외에도 많은 사용자들이 원하는 시간대로 이동하여 특정 부분부터 혹은 특정 부분만을 즐기는 경우도 많다. 이러한 행위를 Seeking이라하며 AVPlayer와 AVPlayerItem은 이러한 기능을 가능케하는 메소드들을 제공한다.</p>

<p><br /></p>

<p>가장 흔한 방법은. <code class="highlighter-rouge">seek(to:)</code> 메소드를 사용하는 것으로 원하는 목적지 시간대의 CMTime 을 다음과 같이 넘겨주면 된다.</p>

<p><br /></p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code>      <span class="c1">// Seek to the 2 minute mark</span>
      <span class="k">let</span> <span class="nv">time</span> <span class="o">=</span> <span class="kt">CMTime</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="mi">120</span><span class="p">,</span> <span class="nv">timescale</span><span class="p">:</span> <span class="mi">1</span><span class="p">)</span>
      <span class="n">player</span><span class="o">.</span><span class="nf">seek</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="n">time</span><span class="p">)</span>
</code></pre>
</div>

<p><br /></p>

<p><code class="highlighter-rouge">seek(to:)</code> 메소드를 이용하면 편리하고 빠르게 원하는 시간대로 이동할 수 있다. 하지만 이 메소드는 정확성보다는 신속함에 맞추어진 메소드이다. 이 뜻은 즉, <strong>개발자가 원하는 시간대와 실제 플레이어가 이동하는 시간대가 다를 수 있다는 것</strong>이다.</p>

<p><br /></p>

<p>보다 정교한 Seeking 동작을 원한다면 <code class="highlighter-rouge">seek(to:toleranceBefore:toleranceAfter:)</code>를 통해 허용되는 시간 편차를 지정할 수 있다. 아주 정교하게 Seeking 작업을 원한다면 허용되는 시간 편차에 0 값을 지정해주면 된다.</p>

<p><br /></p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code>      <span class="c1">// Seek to the first frame at 3:25 mark</span>
      <span class="k">let</span> <span class="nv">seekTime</span> <span class="o">=</span> <span class="kt">CMTime</span><span class="p">(</span><span class="nv">seconds</span><span class="p">:</span> <span class="mi">205</span><span class="p">,</span> <span class="nv">preferredTimescale</span><span class="p">:</span> <span class="kt">Int32</span><span class="p">(</span><span class="kt">NSEC_PER_SEC</span><span class="p">))</span>
      <span class="n">player</span><span class="o">.</span><span class="nf">seek</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="n">seekTime</span><span class="p">,</span> <span class="nv">toleranceBefore</span><span class="p">:</span> <span class="n">kCMTimeZero</span><span class="p">,</span> <span class="nv">toleranceAfter</span><span class="p">:</span> <span class="n">kCMTimeZero</span><span class="p">)</span>
</code></pre>
</div>

<blockquote>
  <p>중요! seek(to:toleranceBefore:toleranceAfter:) 메소드에 허용되는 편차 값을 너무 작게 지정하게 되면 추가적인 디코딩 지연에 빠질 수 있으며 이는 앱의 Seeking 작업에 영향을 미친다.</p>
</blockquote>

<p><br /></p>

<hr />

<h2 id="reference">Reference</h2>

<ul>
  <li>
    <p><a href="https://developer.apple.com/library/archive/documentation/AudioVideo/Conceptual/MediaPlaybackGuide/Contents/Resources/en.lproj/ExploringAVFoundation/ExploringAVFoundation.html#//apple_ref/doc/uid/TP40016757-CH4-SW1">AVFoundation Programming Guide</a></p>
  </li>
  <li>
    <p><a href="https://developer.apple.com/library/archive/documentation/AudioVideo/Conceptual/AVFoundationPG/Articles/02_Playback.html">Media Playback Programming Guide</a></p>
  </li>
</ul>


    <br />
    <br />
  </div>
  

</article>

<!--<hr class="dingbat" />-->
<!--
<div class="share">
  <h2>Share this post</h2>
  <div class="share-body">
    <a href="http://twitter.com/share?text=iOS AVFoundation&amp;url=http://localhost:4000/ios/2019/09/20/iOS-AVFoundation-01/"
      onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
      <span class="icon-twitter">
      </span>
    </a>
    <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/ios/2019/09/20/iOS-AVFoundation-01/"
      onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
      <span class="icon-facebook">
      </span>
    </a>
  </div>
</div>
-->
<br />






  <aside class="author" role="complementary">
    <div class="author">
  <h2 class="page-title hr">
    About
  </h2>
<div class="author-body">
  
    
  

  

  <img
    src="/assets/img/me.jpg"
    class="me"
    alt="youngjun gu"
    srcset="/assets/img/me.jpg 1x,/assets/img/me.jpg 2x"
    
  />


  
  <div class="author-body-description">
    <p>오늘을 기록하고 내일을 코딩하는 개발자</p>

  </div>
</div>
</div>

  </aside>




<aside class="related" role="complementary">
  <h2 class="hr">Related Posts</h2>

  <ul class="related-posts">
    
      
      
      
        
        
          


<li class="h4">
  <a href="/ios/2020/06/29/iOS-Basic-xib%EC%82%AC%EC%9A%A9%EB%B2%95/" data-flip="title">
    <span>xib를 통해 CustomView 만들기 & xib와 nib의 차이</span>
  </a>
  <small><time datetime="2020-06-29T00:00:00+09:00">
    29 Jun 2020
  </time></small>
</li>

        
      
        
        
          


<li class="h4">
  <a href="/ios/2020/06/29/iOS-Basic-maskToBounds&clipsToBounds/" data-flip="title">
    <span>masksToBounds 와 clipsToBounds의 차이점</span>
  </a>
  <small><time datetime="2020-06-29T00:00:00+09:00">
    29 Jun 2020
  </time></small>
</li>

        
      
        
        
          


<li class="h4">
  <a href="/ios/2020/05/28/iOS-Basic-15/" data-flip="title">
    <span>SwiftGen</span>
  </a>
  <small><time datetime="2020-05-28T00:00:00+09:00">
    28 May 2020
  </time></small>
</li>

        
      
        
        
      
    
  </ul>
</aside>


      
        <aside class="comments" role="complementary">
  <h2>Comments</h2>
  <hr/>

  <div id="disqus_thread"></div>

  <script>
    !function(s,i){function e(e){var t=s.pageYOffset||i.body.scrollTop;s.DISQUS&&!s._disqusThis&&!s._disqusFirst&&t+s.innerHeight>=s._disqusThreadOffsetTop&&(s._disqusThis=!0,s.DISQUS.reset({reload:!0,config:d}))}var d=function(){this.page.title="iOS AVFoundation",this.page.identifier="/ios/2019/09/20/iOS-AVFoundation-01",this.page.url="http://localhost:4000/ios/2019/09/20/iOS-AVFoundation-01/"};s._disqusFirst=void 0===s._disqusFirst||s._disqusFirst,s._disqusLoading=void 0!==s._disqusLoading&&s._disqusLoading,s._disqusThis=!1,s._disqusThreadOffsetTop=i.getElementById("disqus_thread").offsetTop,s._disqusLoading?s._disqusFirst=!1:(s._disqusLoading=!0,loadJSDeferred("//gaki.disqus.com/embed.js"),s.addEventListener?s.addEventListener("scroll",e,{passive:!0}):s.attachEvent?s.attachEvent("onscroll",e):s.onscroll=e)}(window,document);

  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
</aside>

      

      <footer>
  <hr/>
  
    <p>© 2020. by Gaki</p>

  
  <p>
    <code>Powered by <a href="https://gaki2745.github.io/">gaki</a></code>
  </p>
</footer>

    </main>
    <div class="right-side">
  <br />
  <br />
</div>

  </div>
  <div id="_yDrawer">
  <div id="_sidebar" class="sidebar">
    <div class="sidebar-bg" style="background-color:#4f86aa;background-image:url(/assets/img/kumo.jpg)"></div>
    <header class="sidebar-sticky" role="banner">
      <br/>
      <div class="sidebar-about">
        <h1><a id="_title" href="/">Gaki</a></h1>
        <p>오늘을 기록하고 내일을 코딩하는 iOS 개발자</p>

      </div>

      <br/>
      <br/>
      <nav class="sidebar-nav heading" role="navigation">
        <span class="sr-only">Navigation:</span>
<ul>
  

  

  
  
  
  
  
    <li>
      <input type="checkbox" id="list-item-1"/>
      <div  class="list-wrapper">
      <a class="sidebar-nav-item" href="/category/ios/">iOS</a>
       <label class="folder" for="list-item-1">▾</label>
    </div>
     <ul class="list-body">
       
           
         
           
         
           
         
           
         
           
         
           
         
           
             <li>
               <a class="sidebar-nav-subitem" href="/tag/ios-basic/">Basic</a>
             </li>
           
         
           
         
           
         
           
             <li>
               <a class="sidebar-nav-subitem" href="/tag/ios-%EB%94%94%EC%9E%90%EC%9D%B8%ED%8C%A8%ED%84%B4/">디자인패턴</a>
             </li>
           
         
           
         
           
             <li>
               <a class="sidebar-nav-subitem" href="/tag/ios-%EC%95%84%ED%82%A4%ED%85%8D%EC%B3%90%ED%8C%A8%ED%84%B4/">아키텍쳐패턴</a>
             </li>
           
         
           
             <li>
               <a class="sidebar-nav-subitem" href="/tag/ios-%ED%85%8C%EC%8A%A4%ED%8C%85/">테스팅</a>
             </li>
           
         
           
             <li>
               <a class="sidebar-nav-subitem" href="/tag/ios-ui%EB%94%94%EC%9E%90%EC%9D%B8/">UI디자인</a>
             </li>
           
         
           
             <li>
               <a class="sidebar-nav-subitem" href="/tag/ios-arkit/">ARKit</a>
             </li>
           
         
           
             <li>
               <a class="sidebar-nav-subitem" href="/tag/ios-avfoundation/">AVFoundation</a>
             </li>
           
         
           
             <li>
               <a class="sidebar-nav-subitem" href="/tag/ios-pop/">POP</a>
             </li>
           
         
     </ul>
    </li>

  
  
    <li>
      <input type="checkbox" id="list-item-2"/>
      <div  class="list-wrapper">
      <a class="sidebar-nav-item" href="/category/swift/">Swift</a>
       <label class="folder" for="list-item-2">▾</label>
    </div>
     <ul class="list-body">
       
           
         
           
         
           
         
           
             <li>
               <a class="sidebar-nav-subitem" href="/tag/swift-basic/">Basic</a>
             </li>
           
         
           
         
           
         
           
         
           
             <li>
               <a class="sidebar-nav-subitem" href="/tag/swift-rxswift/">RxSwift</a>
             </li>
           
         
           
         
           
         
           
             <li>
               <a class="sidebar-nav-subitem" href="/tag/swift-oop/">OOP</a>
             </li>
           
         
           
         
           
         
           
         
           
         
           
         
           
         
     </ul>
    </li>

  
  
    <li>
      <input type="checkbox" id="list-item-3"/>
      <div  class="list-wrapper">
      <a class="sidebar-nav-item" href="/category/algorithm/">Algorithm</a>
       <label class="folder" for="list-item-3">▾</label>
    </div>
     <ul class="list-body">
       
           
             <li>
               <a class="sidebar-nav-subitem" href="/tag/algorithm-problem/">문제풀이</a>
             </li>
           
         
           
             <li>
               <a class="sidebar-nav-subitem" href="/tag/algorithm-swiftalgorithm/">SwiftAlgorithm</a>
             </li>
           
         
           
         
           
         
           
         
           
         
           
         
           
         
           
         
           
         
           
         
           
         
           
         
           
         
           
         
           
         
           
         
     </ul>
    </li>

  
  
    <li>
      <input type="checkbox" id="list-item-4"/>
      <div  class="list-wrapper">
      <a class="sidebar-nav-item" href="/category/swiftui/">SwiftUI</a>
       <label class="folder" for="list-item-4">▾</label>
    </div>
     <ul class="list-body">
       
           
         
           
         
           
         
           
         
           
             <li>
               <a class="sidebar-nav-subitem" href="/tag/swiftui-combine/">Combine</a>
             </li>
           
         
           
         
           
         
           
         
           
         
           
         
           
         
           
         
           
         
           
         
           
         
           
         
           
         
     </ul>
    </li>

  
  
    <li>
      <input type="checkbox" id="list-item-5"/>
      <div  class="list-wrapper">
      <a class="sidebar-nav-item" href="/category/wwdc/">WWDC</a>
       <label class="folder" for="list-item-5">▾</label>
    </div>
     <ul class="list-body">
       
           
         
           
         
           
         
           
         
           
         
           
             <li>
               <a class="sidebar-nav-subitem" href="/tag/wwdc-2019/">2019</a>
             </li>
           
         
           
         
           
         
           
         
           
         
           
         
           
         
           
         
           
         
           
         
           
         
           
         
     </ul>
    </li>

  
  
    <li>
      <input type="checkbox" id="list-item-6"/>
      <div  class="list-wrapper">
      <a class="sidebar-nav-item" href="/category/life/">Life</a>
       <label class="folder" for="list-item-6">▾</label>
    </div>
     <ul class="list-body">
       
           
         
           
         
           
             <li>
               <a class="sidebar-nav-subitem" href="/tag/life-review/">후기</a>
             </li>
           
         
           
         
           
         
           
         
           
         
           
         
           
             <li>
               <a class="sidebar-nav-subitem" href="/tag/life-retrospect/">회고</a>
             </li>
           
         
           
         
           
         
           
         
           
         
           
         
           
         
           
         
           
         
     </ul>
    </li>

  
  
    <li>
      <input type="checkbox" id="list-item-7"/>
      <div  class="list-wrapper">
      <a class="sidebar-nav-item" href="/about/">About</a>
       
    </div>
     <ul class="list-body">
       
           
         
           
         
           
         
           
         
           
         
           
         
           
         
           
         
           
         
           
         
           
         
           
         
           
         
           
         
           
         
           
         
           
         
     </ul>
    </li>

  
</ul>

      </nav>
    <br/>
    <br/>
      <div class="sidebar-box">
        
          
  

  

  <img
    src="/assets/img/me.jpg"
    class="me"
    alt="youngjun gu"
    srcset="/assets/img/me.jpg 1x,/assets/img/me.jpg 2x"
    
  />


        
      </div>
      <p>Be Faithful to the Basic!!</p>

      
      
        <div class="sidebar-social">
          <span class="sr-only">Social:</span>
<ul>
  
    









<li>
  <a href="https://facebook.com/yeongjun.gu">
    <span class="icon-facebook" title="Facebook"></span>
    <span class="sr-only">Facebook</span>
  </a>
</li>

  
    









<li>
  <a href="https://github.com/gaki2745">
    <span class="icon-github" title="GitHub"></span>
    <span class="sr-only">GitHub</span>
  </a>
</li>

  
    









<li>
  <a href="mailto:guyeongjun@naver.com">
    <span class="icon-mail" title="Email"></span>
    <span class="sr-only">Email</span>
  </a>
</li>

  
    









<li>
  <a href="https://gaki2745.github.io/feed.xml">
    <span class="icon-rss2" title="RSS"></span>
    <span class="sr-only">RSS</span>
  </a>
</li>

  
</ul>

        </div>
      
    </header>
  </div>
</div>
</div>

<!-- =============== -->
<!-- SCRIPTS         -->
<!-- =============== -->

<script>
  window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
  ga('create', 'UA-92346434-1', 'auto');
  ga('send', 'pageview');
  loadJSDeferred('https://www.google-analytics.com/analytics.js');
</script>





<!--[if gt IE 8]><!---->
<script src="//ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js"></script>
<script>
  WebFont.load({
    
    google: {
      families: 'Lato'.split('|')
    },
    

    custom: {
      families: ['icomoon'],
      urls: ['/assets/icomoon/style.css']
    }
  });
</script>
<!--<![endif]-->


  <!--[if gt IE 9]><!---->
  
  <script>loadJSDeferred('/assets/js/hydejack.js?v=6.4.0');</script>

  
  <!--<![endif]-->



</body>

</html>
